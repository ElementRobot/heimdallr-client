{"version":3,"sources":["heimdallr-client.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","heimdallrClient","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"_dereq_","./lib/heimdallr-client.js",2,"Client","token","options","ready","readyCallbacks","handlers","connection","io","connect","url","on","emit","map","fn","bind","err","Object","hasOwnProperty","message","Provider","apply","arguments","Consumer","onReady","client","args","Array","prototype","slice","push","msgName","removeListener","sendEvent","subtype","data","Date","toISOString","sendSensor","sendStream","completed","uuid","subscribe","provider","unsubscribe","setFilter","filter","event","sensor","getState","subtypes","sendControl","persistent","control","joinStream","leaveStream","socket.io-client",3,"./lib/",4,"lookup","uri","opts","undefined","parsed","source","id","forceNew","multiplex","debug","Manager","cache","socket","path","parser","managers","protocol","Socket","./manager","./socket","./url","socket.io-parser",5,"nsps","subs","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","randomizationFactor","backoff","Backoff","min","max","jitter","timeout","readyState","connected","encoding","packetBuffer","encoder","Encoder","decoder","Decoder","autoConnect","open","eio","Emitter","indexOf","emitAll","nsp","updateSocketIds","engine","v","_reconnection","_reconnectionAttempts","_reconnectionDelay","setMin","_randomizationFactor","setJitter","_reconnectionDelayMax","setMax","_timeout","maybeReconnectOnOpen","reconnecting","attempts","reconnect","skipReconnect","openSub","onopen","errorSub","cleanup","timer","setTimeout","destroy","close","clearTimeout","ondata","add","ondecoded","packet","onerror","index","splice","encode","encodedPackets","write","processPacketQueue","pack","shift","sub","disconnect","reset","onclose","reason","delay","duration","onreconnect","attempt","./on","backo2","component-bind","component-emitter","engine.io-client","indexof","object-component",6,"obj","ev",7,"json","ids","acks","receiveBuffer","sendBuffer","disconnected","toArray","hasBin","events","connect_error","connect_timeout","error","reconnect_attempt","reconnect_failed","reconnect_error","subEvents","send","unshift","parserType","EVENT","BINARY_EVENT","type","pop","CONNECT","onpacket","onconnect","onevent","ACK","onack","BINARY_ACK","DISCONNECT","ondisconnect","ERROR","ack","sent","emitBuffered","has-binary","to-array",8,"loc","location","host","charAt","hostname","test","parseuri","port","href",9,"ms","factor","Math","pow","rand","random","deviation","floor",10,"concat",11,"mixin","key","addEventListener","_callbacks","once","off","removeAllListeners","removeEventListener","callbacks","cb","len","listeners","hasListeners",12,"name","enabled","fmt","coerce","curr","humanize","console","log","Function","val","stack","names","skips","enable","localStorage","split","replace","RegExp","substr","disable","sec","hour","toFixed",13,14,"engine.io-parser",15,"secure","query","pieces","agent","parseqs","decode","upgrade","forceJSONP","jsonp","forceBase64","enablesXDR","timestampParam","timestampRequests","transports","writeBuffer","callbackBuffer","policyPort","rememberUpgrade","binaryType","onlyBinaryUpgrades","pfx","passphrase","cert","ca","ciphers","rejectUnauthorized","clone","parsejson","priorWebsocketSuccess","Transport","createTransport","EIO","transport","sid","setTransport","onDrain","onPacket","onError","onClose","probe","onTransportOpen","upgradeLosesBinary","supportsBinary","failed","msg","upgrading","pause","flush","freezeTransport","onTransportClose","onupgrade","to","onOpen","upgrades","onHandshake","setPing","filterUpgrades","pingInterval","pingTimeout","onHeartbeat","pingTimeoutTimer","pingIntervalTimer","ping","sendPacket","prevBufferLen","writable","cleanupAndClose","waitForUpgrade","desc","filteredUpgrades","j","./transport","./transports",16,"timestamps","description","doOpen","doClose","packets","onData","decodePacket",17,"polling","xhr","xd","xs","isSSL","xdomain","xscheme","XMLHttpRequest","XHR","JSONP","websocket","./polling-jsonp","./polling-xhr","./websocket","xmlhttprequest",18,"empty","JSONPPolling","Polling","___eio","document","script","inherit","rNewline","rEscapedNewline","parentNode","removeChild","form","iframe","doPoll","createElement","async","src","insertAt","getElementsByTagName","insertBefore","isUAgecko","navigator","userAgent","body","appendChild","doWrite","complete","initIframe","html","iframeId","area","className","style","position","top","left","target","method","setAttribute","action","value","submit","attachEvent","onreadystatechange","onload","./polling","component-inherit",19,"Request","isBinary","create","unloadHandler","requests","abort","request","req","sendXhr","pollXhr","responseType","setRequestHeader","withCredentials","hasXDR","onLoad","responseText","status","requestsCount","onSuccess","fromError","contentType","getResponseHeader","response","XDomainRequest",20,"hasXHR2","poll","onPause","total","callback","decodePayload","callbackfn","encodePayload","schema","b64","../transport",21,"WS","WebSocket","check","protocols","ws","addEventListeners","onmessage","ondrain","encodePacket",22,"hasCORS","ActiveXObject","has-cors",23,"b","constructor",24,"useColors","documentElement","firebug","exception","table","toLowerCase","match","parseInt","$1","formatArgs","namespace","diff","c","color","lastC","save","namespaces","removeItem","load","colors","formatters","JSON","stringify","./debug",25,"selectColor","prevColor","disabled","prevTime","prev","format","formatter","logFn",26,"parse","str","exec","parseFloat","y","d","h","m","short","round","long","plural","ceil",27,"encodeBase64Object","encodeArrayBuffer","encodeBase64Packet","contentArray","Uint8Array","resultBuffer","byteLength","buffer","encodeBlobAsArrayBuffer","fr","FileReader","result","readAsArrayBuffer","encodeBlob","dontSendBlobs","blob","Blob","ary","each","done","next","after","eachWithIndex","el","keys","hasBinary","sliceBuffer","base64encoder","utf8","isAndroid","isPhantomJS","pong","noop","packetslist","utf8encode","ArrayBuffer","base64","encoded","String","readAsDataURL","b64data","fromCharCode","typed","basic","btoa","utf8decode","decodeBase64Packet","Number","substring","asArray","rest","setLengthHeader","encodeOne","doneCallback","encodePayloadAsBlob","encodePayloadAsArrayBuffer","results","join","decodePayloadAsBinary","chr","ret","totalLength","reduce","acc","p","toString","resultArray","bufferIndex","forEach","isString","ab","view","charCodeAt","lenStr","binaryIdentifier","size","lengthAry","bufferTail","buffers","numberTooLong","tailArray","msgLength","./keys","arraybuffer.slice","base64-arraybuffer",28,"arr","has",29,"count","err_cb","proxy","bail",30,"arraybuffer","start","end","bytes","abv","ii",31,"chars","encoded1","encoded2","encoded3","encoded4","bufferLength",32,"BlobBuilderConstructor","bb","BlobBuilder","append","getBlob","WebKitBlobBuilder","MSBlobBuilder","MozBlobBuilder","blobSupported","blobBuilderSupported",33,"_hasBinary","Buffer","isBuffer","File","isArray","toJSON","isarray",34,35,"root","ucs2decode","string","extra","output","counter","ucs2encode","array","stringFromCharCode","createByte","codePoint","encodeCodePoint","symbol","codePoints","byteString","readContinuationByte","byteIndex","byteCount","continuationByte","byteArray","decodeSymbol","byte1","byte2","byte3","byte4","tmp","freeExports","freeModule","freeGlobal","version","nodeType","object",36,37,38,"rvalidchars","rvalidescape","rvalidtokens","rvalidbraces","rtrimLeft","rtrimRight",39,"encodeURIComponent","qs","qry","pairs","pair","decodeURIComponent",40,"re","parts","authority","ipv6uri",41,"instance","MozWebSocket",42,43,"dup",44,45,"values","vals","merge","isEmpty",46,47,"isBuf","deconstructPacket","_deconstructPacket","placeholder","_placeholder","num","newData","packetData","attachments","reconstructPacket","_reconstructPacket","buf","removeBlobs","_removeBlobs","curKey","containingObject","pendingBlobs","fileReader","bloblessData","./is-buffer",48,"encodeAsString","encodeAsBinary","writeEncoding","deconstruction","binary","reconstructor","decodeString","types","BinaryReconstructor","reconPack","takeBinaryData","finishedReconstruction","binData","./binary","json3",49,50,51,"undef","isSupported","serialized","JSON3","stringifySupported","isExtended","getClass","parseSupported","isProperty","isLoader","nativeJSON","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","functionClass","dateClass","numberClass","stringClass","arrayClass","booleanClass","charIndexBuggy","Months","getDay","year","month","property","members","__proto__","original","parent","PrimitiveTypes","boolean","number","isHostType","Properties","valueOf","isFunction","isConstructor","hasProperty","Escapes",92,"leadingZeroes","toPaddedString","width","unicodePrefix","quote","symbols","isLarge","charCode","serialize","properties","whitespace","indentation","date","time","hours","minutes","seconds","milliseconds","element","prefix","TypeError","Index","Source","Unescapes",98,116,110,102,114,"SyntaxError","lex","begin","isSigned","get","hasMembers","update","walk",52,"list"],"mappings":"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","file":"heimdallr-client.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.heimdallrClient = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\nmodule.exports = _dereq_('./lib/heimdallr-client.js');\n\n},{\"./lib/heimdallr-client.js\":2}],2:[function(_dereq_,module,exports){\n/** @module heimdallrClient */\n\nvar io = _dereq_('socket.io-client');\n\n/**\n * A Heimdallr packet is a JSON object. It is how information is\n * transferred between the Heimdallr server and Heimdallr clients. The types\n * of packet are [event]{@link module:heimdallrClient~event},\n * [sensor]{@link module:heimdallrClient~sensor}, and\n * [control]{@link module:heimdallrClient~control}. A Heimdallr packet will\n * always contain <tt>subtype</tt> and <tt>data</tt> fields. It may contain\n * other fields depending on the packet type. Furthermore, some fields may\n * be modified by the Heimdallr server before being relayed to clients.\n * Each packet type has a JSONSchema that the server will validate the packet\n * against. In addition, the packet <tt>data</tt> field will be validated\n * against the associated provider's JSONSchema for the packet subtype.\n *\n * @typedef {} packet\n * @prop {string} subtype - The packet's subtype.\n * @prop {} data - The packet's data.\n */\n\n/**\n * A Heimdallr event packet is a packet that originates from a\n * provider and contains information about the state of the provider. Event \n * packets are used to transmit discrete, persistent, stateful information \n * about the provider. For instance a provider may send an event packet with a\n * <tt>'locked'</tt> subtype and data of <tt>'true'</tt>. This locked state will persist in \n * Heimdallr until the provider sends another event packet with a <tt>'locked'</tt> subtype.\n * <br><br>\n * A consumer can listen for event packets by specifying <tt>msgName</tt>\n * as <tt>'event'</tt> when calling the\n * [on]{@link module:heimdallrClient~Client#on} function. In addition to the\n * standard packet <tt>subtype</tt> and <tt>data</tt> fields, a Heimdallr event\n * packet must have a <tt>t</tt> field. When the Heimdallr server\n * receives an event packet it will add a <tt>provider</tt> field before\n * sending it on to subscribed consumers. All providers have a JSONSchema for\n * the <tt>'completed'</tt> subtype that is used for signaling the\n * completion of a persistent control packet. The event packet\n * <tt>'connected'</tt> subtype is reserved and should not be sent by\n * providers. Instead this event will be emitted by the Heimdallr server\n * on behalf of the provider every time the provider dis/connects. The\n * <tt>data</tt> field for the <tt>'connected'</tt> subtype is a boolean\n * indicating whether or not the provider is connected to Heimdallr.\n * Event packets are graphed as a timeline.\n * \n * @typedef {} event\n * @prop {string} subtype - The packet's subtype.\n * @prop {} data - The packet's data.\n * @prop {string} t - [ISO 8601]{@link http://en.wikipedia.org/wiki/ISO_8601}\n *     formatted string.\n * @prop {string} provider - UUID of the provider from which it originated.\n */\n\n/**\n * A Heimdallr sensor packet is a packet that originates from a\n * provider and contains information about a measurement made by the provider.\n * Sensor packets are used to transmit samplings of continuous physical data,\n * and unlike event packets, are only considered valid for the time at which\n * the measurement was taken. For instance, a provider may transmit a sensor\n * packet with a subtype <tt>'reactor_temperature_c'</tt>, data <tt>75.03</tt>,\n * and t <tt>'2015-02-28T20:16:12Z'</tt>.\n * <br><br>\n * A consumer can listen for sensor packets by specifying <tt>msgName</tt>\n * as <tt>'sensor'</tt> when calling the\n * [on]{@link module:heimdallrClient~Client#on} function. In addition to the\n * standard packet <tt>subtype</tt> and <tt>data</tt>\n * fields, a Heimdallr sensor packet must have a <tt>t</tt> field.\n * When the Heimdallr server receives a sensor packet it will add a\n * <tt>provider</tt> field before sending it on to subscribed consumers.\n * Sensor packets are graphed as an f(t) plot.\n *\n * @typedef {} sensor\n * @prop {string} subtype - The packet's subtype.\n * @prop {} data - The packet's data.\n * @prop {string} t - [ISO 8601]{@link http://en.wikipedia.org/wiki/ISO_8601}\n *     formatted string.\n * @prop {string} provider - UUID of the provider from which it originated.\n */\n\n/**\n * A Heimdallr control packet is a packet that originates from a consumer\n * and contains information that should be used by the provider. A\n * provider can listen for control packets by specifying <tt>msgName</tt>\n * as <tt>'control'</tt> when calling the\n * [on]{@link module:heimdallrClient~Client#on} function. In addition to the\n * standard packet <tt>subtype</tt> and <tt>data</tt>\n * fields, a Heimdallr control packet must have a <tt>provider</tt>\n * field specifying which provider the control packet should be sent to.\n * If <tt>persistent</tt> is truthy, the Heimdallr server will change the value\n * of the field to a UUID before sending it to the provider. Each time\n * the provider re-connects the control packet will be re-sent until the\n * provider sends an event packet with the subtype\n * <tt>'completed'</tt>. The control packet <tt>'stream'</tt> subtype is\n * reserved and should not be sent by consumers. Instead this control will be\n * sent by the Heimdallr server on behalf of a consumer. The <tt>'stream'</tt>\n * subtype is used to signal that the binary data stream should start or stop.\n *\n * @typedef {} control\n * @prop {string} subtype - The packet's subtype.\n * @prop {} data - The packet's data.\n * @prop {string} provider - UUID of the provider to send the control\n *     packet to.\n * @prop {boolean|string} [persistent] - Whether or not the control\n *     packet should persist. \n */\n\n/**\n * Callback for socket.io messages.\n *\n * @callback msgCallback\n * @arg {} data - Data sent with the message.\n */\n\n\n/**\n * The Client constructor takes an authentication token and\n * attempts to connect to the Heimdallr server using the token.\n *\n * @class\n * @classdesc Base class for Heimdallr clients.\n * @private\n * @arg {string} token - Authentication token, provider or consumer.\n * @arg {object} options - socket.io options passed to io.connect.\n * @return {module:heimdallrClient~Client} A new Heimdallr Client object.\n */\nfunction Client(token, options){\n    this.ready = false;\n    this.readyCallbacks = [];\n    this.handlers = {};\n\n    this.connection = new io.connect(this.url, options);\n    this.connection.on('connect', function(){\n        // If they want to authorize right off, let them\n        this.connection.emit('authorize', {'token': token});\n        this.connection.on('auth-success', function callReady(){\n            this.readyCallbacks.map(function(fn, i){\n                fn();\n            });\n            this.readyCallbacks = [];\n            this.ready = true;\n        }.bind(this));\n    }.bind(this));\n\n    this.connection.on('err', function(err){\n        if(err instanceof Error){\n            throw err;\n        }\n        else if(err instanceof Object){\n            if(err.hasOwnProperty('message')){\n                throw new Error(err.message);\n            }\n        }\n        throw new Error(err);\n    });\n}\n\n/**\n * Add a socket.io message listener. A socket.io message is any communication\n * emitted by a socket.io client or server. Heimdallr\n * [packets]{@link module:heimdallrClient~packet} are a special instance\n * of a socket.io message.\n *\n * @method\n * @arg {string} msgName - Name of the socket.io message to listen for.\n * @arg {msgCallback} fn - [Callback]{@link module:heimdallrClient~msgCallback}\n *     to run when socket.io message is heard.\n * @return {module:heimdallrClient~Client}\n */\nClient.prototype.on = function on(msgName, fn){\n    if(msgName === 'ready'){\n        onReady(fn)();\n    }\n    else {\n        this.connection.on(msgName, fn);\n    }\n\n    return this;\n};\n\n/**\n * Removes a socket.io message listener.\n *\n * @method\n * @arg {string} msgName - Name of the socket.io message to\n *     remove listener for.\n * @return {module:heimdallrClient~Client}\n */\n Client.prototype.removeListener = function removeListener(msgName) {\n     this.connection.removeListener(msgName);\n     return this;\n };\n\n/**\n * @private\n * @prop {string} url - The URL of the Heimdallr server\n */\n// Leave this as an undocumented back door for ourselves for the time being\nClient.prototype.url = 'https://heimdallr.skyforge.co';\n\n\n/**\n * The Provider constructor works in the same way as the Client constructor,\n * but it connects to the /provider namespace.\n *\n * @class\n * @classdesc Heimdallr provider class.\n * @extends {module:heimdallrClient~Client}\n * @arg {string} token - A provider authentication token.\n * @arg {object} options - socket.io options passed to io.connect.\n * @return {module:heimdallrClient~Provider} A new Heimdallr Provider object.\n */\nfunction Provider(){\n    this.url += '/provider';\n    Client.apply(this, arguments);\n}\nProvider.prototype = Client.prototype;\n\n/**\n * Sends an event packet to the Heimdallr server. The event\n * will be saved and then relayed to all subscribed consumers.\n * <tt>data</tt> must adhere to the provider's JSONSchema\n * for the given subtype.\n * \n * @method\n * @arg {string} subtype - The event packet subtype.\n * @arg {json} data - The event packet data.\n * @return {module:heimdallrClient~Provider}\n */\nProvider.prototype.sendEvent = onReady(function sendEvent(subtype, data){\n    this.connection.emit('event', {\n        'subtype': subtype,\n        'data': data,\n        't': (new Date()).toISOString()\n    });\n});\n\n/**\n * Sends a sensor packet to the Heimdallr server. The sensor packet will be\n * saved and then relayed to all subscribed consumers. \n * <tt>data</tt> must adhere to the provider's JSONSchema\n * for the given subtype.\n * \n * @method\n * @arg {string} subtype - The sensor packet subtype.\n * @arg {json} data - The sensor packet data.\n * @return {module:heimdallrClient~Provider}\n */\nProvider.prototype.sendSensor = onReady(function sendSensor(subtype, data){\n    this.connection.emit('sensor', {\n        'subtype': subtype,\n        'data': data,\n        't': (new Date()).toISOString()\n    });\n});\n\n/**\n * Sends binary data to the Heimdallr server. This should only be\n * used when the Heimdallr server has issued a <tt>{'stream': 'start'}</tt>\n * control packet and should stop when the Heimdallr server has\n * issued a <tt>{'stream': 'stop'}</tt> control packet. This data will be\n * relayed to all subscribed consumers who have also joined the\n * stream for this provider. This data will not be saved.\n * \n * @method\n * @arg {} data - The binary data to be sent.\n * @return {module:heimdallrClient~Provider}\n */\nProvider.prototype.sendStream = onReady(function sendStream(data){\n    this.connection.emit('stream', data);\n});\n\n/**\n * Convenience method for <tt>sendEvent('completed', uuid)</tt>.\n * Tell Heimdallr server that the persistent control packet whose data field is\n * <tt>uuid</tt> has been completed. A persistent control will be sent to a\n * provider when it is first issued, and again on every reconnect\n * until the provider signals that the control has been completed.\n *\n * @method\n * @arg {string} uuid - UUID of the persistent control packet that has been\n *     completed.\n * @return {module:heimdallrClient~Provider}\n */\nProvider.prototype.completed = onReady(function completed(uuid){\n    this.connection.emit('event', {\n        'subtype': 'completed',\n        'data': uuid,\n        't': (new Date()).toISOString()\n    });\n});\n\n\n/**\n * The Consumer constructor works in the same way as the Client constructor,\n * but it connects to the /consumer namespace.\n *\n * @class\n * @classdesc Heimdallr consumer class.\n * @extends {module:heimdallrClient~Client}\n * @arg {string} token - A consumer authentication token.\n * @arg {object} options - socket.io options passed to io.connect.\n * @return {module:heimdallrClient~Consumer} A new Heimdallr Consumer object.\n */\nfunction Consumer(){\n    this.url += '/consumer';\n    Client.apply(this, arguments);\n}\nConsumer.prototype = Client.prototype;\n\n/**\n * Subscribe to a provider. A consumer must subscribe to a provider\n * before it receives event or sensor packets from the provider or can\n * send control packets to the provider.\n *\n * @method\n * @arg {string} uuid - UUID of the provider to subscribe to.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.subscribe = onReady(function subscribe(uuid){\n    this.connection.emit('subscribe', {'provider': uuid});\n});\n\n/**\n * Unsubscribe from provider. This will be done automatically \n * by the Heimdallr server on disconnect.\n * \n * @method\n * @arg {string} uuid - UUID of the provider to unsubscribe from.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.unsubscribe = onReady(function unsubscribe(uuid){\n    this.connection.emit('unsubscribe', {'provider': uuid});\n});\n\n/**\n * Control which event and sensor packets to listen to. The <tt>filter</tt>\n * object keys should refer to the packet type and the value should be an\n * array of subtypes for the given packet type specified by the key. To clear\n * a filter that you have already set, pass an empty array instead of an array\n * of subtypes.\n *\n * @method\n * @arg {string} uuid - UUID of the provider to filter packets from.\n * @arg {object} filter - Object containing event and sensor packet\n *     subtypes that you want to receive.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.setFilter = onReady(function setFilter(uuid, filter){\n    filter = filter || {};\n    if(!(filter.event instanceof Array) && !(filter.sensor instanceof Array)){\n        throw new Error('Invalid `filter`');\n    }\n    filter.provider = uuid;\n    this.connection.emit('setFilter', filter);\n});\n\n/**\n * Get the current state of a provider. For each event packet subtype\n * specified, the latest event packet of that subtype will be sent to the\n * consumer by the server.\n * \n * @method\n * @arg {string} uuid - UUID of the provider to get state for.\n * @arg {array} subtypes - array of event packet subtypes to get.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.getState = onReady(function getState(uuid, subtypes){\n    if(!(subtypes instanceof Array)){\n        throw new Error('`subtypes` must be an array');\n    }\n    this.connection.emit('getState', {'provider': uuid, 'subtypes': subtypes});\n});\n\n/**\n * Send a control packet to a provider. Must adhere to the provider's\n * JSONSchema for the subtype of the control packet.\n * If <tt>persistent</tt> is truthy, a persistent field will be\n * included along with the control packet data.\n * The value of the persistent field will be a new UUID that can be used\n * to signal the Heimdallr server that the control packet has been\n * completed. To do so, the provider must send a <tt>'completed'</tt> event\n * packet with UUID included in the data field. The control packet will be\n * re-sent every time the provider re-connects to Heimdallr until\n * the Heimdallr server has been told that it has been completed.\n *\n * @method\n * @arg {string} uuid - Provider to send the control packet to.\n * @arg {string} subtype - The control packet subtype.\n * @arg {json} data - The control packet data.\n * @arg {boolean} [persistent] - Whether or not the control\n *     should persist.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.sendControl = onReady(function sendControl(uuid, subtype, data, persistent){\n    var control = {\n        'subtype': subtype,\n        'data': data,\n        'provider': uuid\n    };\n\n    if(persistent){\n        control.persistent = true;\n    }\n    this.connection.emit('control', control);\n});\n\n/**\n * Join binary data stream from a provider. If this is the first\n * consumer to join the stream from a provider, the Heimdallr server\n * will send a <tt>{\"stream\": \"start\"}</tt> control packet to the provider.\n * \n * @method\n * @arg {string} uuid - UUID of the provider to join stream for.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.joinStream = onReady(function joinStream(uuid){\n    this.connection.emit('joinStream', {'provider': uuid});\n});\n\n/**\n * Leave binary data stream for a provider. If this is the last\n * consumer to leave the stream for a provider the Heimdallr server\n * will send a <tt>{\"stream\": \"stop\"}</tt> control packet to the provider. This\n * will be done automatically by the Heimdallr server on disconnect.\n *\n * @method\n * @arg {string} uuid - UUID of the provider to leave stream for.\n * @return {module:heimdallrClient~Consumer}\n */\nConsumer.prototype.leaveStream = onReady(function leaveStream(uuid){\n    this.connection.emit('leaveStream', {'provider': uuid});\n});\n\n\n/**\n * Decorator that creates a function which will wait until the Client is\n * ready to to call the input <tt>fn</tt>. Any calls to the decorated function\n * will check if the client is ready. If it is ready, it will call\n * the function immediately. If it is not, it will add it to a\n * queue of callbacks that will be called once the Client is ready.\n * The client is ready once it has connected to the Heimdallr\n * server and received an 'auth-success' socket.io message.\n * \n * @func onReady\n * @private\n * @arg {function} fn - Function to decorate.\n * @return {function} The decorated function that will postpone calls to it\n *     until the client is ready.\n */\nfunction onReady(fn){\n    return function(){\n        // By assinging `this` to client, we can force this scope to be\n        // preserved. Otherwise, if the client isn't ready and the function\n        // gets pushed onto `readyCallbacks`, `this` will be the global object\n        // when the `readyCallbacks` are finally called.\n        var client = this,\n            args = Array.prototype.slice.call(arguments);\n        if(client.ready){\n            fn.apply(client, args);\n        }\n        else {\n            client.readyCallbacks.push(function(){\n                fn.apply(client, args);\n            });\n        }\n        return client;\n    };\n}\n\nmodule.exports = {\n    Provider: Provider,\n    Consumer: Consumer\n};\n\n},{\"socket.io-client\":3}],3:[function(_dereq_,module,exports){\n\nmodule.exports = _dereq_('./lib/');\n\n},{\"./lib/\":4}],4:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar url = _dereq_('./url');\nvar parser = _dereq_('socket.io-parser');\nvar Manager = _dereq_('./manager');\nvar debug = _dereq_('debug')('socket.io-client');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = lookup;\n\n/**\n * Managers cache.\n */\n\nvar cache = exports.managers = {};\n\n/**\n * Looks up an existing `Manager` for multiplexing.\n * If the user summons:\n *\n *   `io('http://localhost/a');`\n *   `io('http://localhost/b');`\n *\n * We reuse the existing instance based on same scheme/port/host,\n * and we initialize sockets for each namespace.\n *\n * @api public\n */\n\nfunction lookup(uri, opts) {\n  if (typeof uri == 'object') {\n    opts = uri;\n    uri = undefined;\n  }\n\n  opts = opts || {};\n\n  var parsed = url(uri);\n  var source = parsed.source;\n  var id = parsed.id;\n  var io;\n\n  if (opts.forceNew || opts['force new connection'] || false === opts.multiplex) {\n    debug('ignoring socket cache for %s', source);\n    io = Manager(source, opts);\n  } else {\n    if (!cache[id]) {\n      debug('new io instance for %s', source);\n      cache[id] = Manager(source, opts);\n    }\n    io = cache[id];\n  }\n\n  return io.socket(parsed.path);\n}\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nexports.protocol = parser.protocol;\n\n/**\n * `connect`.\n *\n * @param {String} uri\n * @api public\n */\n\nexports.connect = lookup;\n\n/**\n * Expose constructors for standalone build.\n *\n * @api public\n */\n\nexports.Manager = _dereq_('./manager');\nexports.Socket = _dereq_('./socket');\n\n},{\"./manager\":5,\"./socket\":7,\"./url\":8,\"debug\":12,\"socket.io-parser\":48}],5:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar url = _dereq_('./url');\nvar eio = _dereq_('engine.io-client');\nvar Socket = _dereq_('./socket');\nvar Emitter = _dereq_('component-emitter');\nvar parser = _dereq_('socket.io-parser');\nvar on = _dereq_('./on');\nvar bind = _dereq_('component-bind');\nvar object = _dereq_('object-component');\nvar debug = _dereq_('debug')('socket.io-client:manager');\nvar indexOf = _dereq_('indexof');\nvar Backoff = _dereq_('backo2');\n\n/**\n * Module exports\n */\n\nmodule.exports = Manager;\n\n/**\n * `Manager` constructor.\n *\n * @param {String} engine instance or engine uri/opts\n * @param {Object} options\n * @api public\n */\n\nfunction Manager(uri, opts){\n  if (!(this instanceof Manager)) return new Manager(uri, opts);\n  if (uri && ('object' == typeof uri)) {\n    opts = uri;\n    uri = undefined;\n  }\n  opts = opts || {};\n\n  opts.path = opts.path || '/socket.io';\n  this.nsps = {};\n  this.subs = [];\n  this.opts = opts;\n  this.reconnection(opts.reconnection !== false);\n  this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n  this.reconnectionDelay(opts.reconnectionDelay || 1000);\n  this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n  this.randomizationFactor(opts.randomizationFactor || 0.5);\n  this.backoff = new Backoff({\n    min: this.reconnectionDelay(),\n    max: this.reconnectionDelayMax(),\n    jitter: this.randomizationFactor()\n  });\n  this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n  this.readyState = 'closed';\n  this.uri = uri;\n  this.connected = [];\n  this.encoding = false;\n  this.packetBuffer = [];\n  this.encoder = new parser.Encoder();\n  this.decoder = new parser.Decoder();\n  this.autoConnect = opts.autoConnect !== false;\n  if (this.autoConnect) this.open();\n}\n\n/**\n * Propagate given event to sockets and emit on `this`\n *\n * @api private\n */\n\nManager.prototype.emitAll = function() {\n  this.emit.apply(this, arguments);\n  for (var nsp in this.nsps) {\n    this.nsps[nsp].emit.apply(this.nsps[nsp], arguments);\n  }\n};\n\n/**\n * Update `socket.id` of all sockets\n *\n * @api private\n */\n\nManager.prototype.updateSocketIds = function(){\n  for (var nsp in this.nsps) {\n    this.nsps[nsp].id = this.engine.id;\n  }\n};\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Manager.prototype);\n\n/**\n * Sets the `reconnection` config.\n *\n * @param {Boolean} true/false if it should automatically reconnect\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnection = function(v){\n  if (!arguments.length) return this._reconnection;\n  this._reconnection = !!v;\n  return this;\n};\n\n/**\n * Sets the reconnection attempts config.\n *\n * @param {Number} max reconnection attempts before giving up\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionAttempts = function(v){\n  if (!arguments.length) return this._reconnectionAttempts;\n  this._reconnectionAttempts = v;\n  return this;\n};\n\n/**\n * Sets the delay between reconnections.\n *\n * @param {Number} delay\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionDelay = function(v){\n  if (!arguments.length) return this._reconnectionDelay;\n  this._reconnectionDelay = v;\n  this.backoff && this.backoff.setMin(v);\n  return this;\n};\n\nManager.prototype.randomizationFactor = function(v){\n  if (!arguments.length) return this._randomizationFactor;\n  this._randomizationFactor = v;\n  this.backoff && this.backoff.setJitter(v);\n  return this;\n};\n\n/**\n * Sets the maximum delay between reconnections.\n *\n * @param {Number} delay\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionDelayMax = function(v){\n  if (!arguments.length) return this._reconnectionDelayMax;\n  this._reconnectionDelayMax = v;\n  this.backoff && this.backoff.setMax(v);\n  return this;\n};\n\n/**\n * Sets the connection timeout. `false` to disable\n *\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.timeout = function(v){\n  if (!arguments.length) return this._timeout;\n  this._timeout = v;\n  return this;\n};\n\n/**\n * Starts trying to reconnect if reconnection is enabled and we have not\n * started reconnecting yet\n *\n * @api private\n */\n\nManager.prototype.maybeReconnectOnOpen = function() {\n  // Only try to reconnect if it's the first time we're connecting\n  if (!this.reconnecting && this._reconnection && this.backoff.attempts === 0) {\n    // keeps reconnection from firing twice for the same reconnection loop\n    this.reconnect();\n  }\n};\n\n\n/**\n * Sets the current transport `socket`.\n *\n * @param {Function} optional, callback\n * @return {Manager} self\n * @api public\n */\n\nManager.prototype.open =\nManager.prototype.connect = function(fn){\n  debug('readyState %s', this.readyState);\n  if (~this.readyState.indexOf('open')) return this;\n\n  debug('opening %s', this.uri);\n  this.engine = eio(this.uri, this.opts);\n  var socket = this.engine;\n  var self = this;\n  this.readyState = 'opening';\n  this.skipReconnect = false;\n\n  // emit `open`\n  var openSub = on(socket, 'open', function() {\n    self.onopen();\n    fn && fn();\n  });\n\n  // emit `connect_error`\n  var errorSub = on(socket, 'error', function(data){\n    debug('connect_error');\n    self.cleanup();\n    self.readyState = 'closed';\n    self.emitAll('connect_error', data);\n    if (fn) {\n      var err = new Error('Connection error');\n      err.data = data;\n      fn(err);\n    } else {\n      // Only do this if there is no fn to handle the error\n      self.maybeReconnectOnOpen();\n    }\n  });\n\n  // emit `connect_timeout`\n  if (false !== this._timeout) {\n    var timeout = this._timeout;\n    debug('connect attempt will timeout after %d', timeout);\n\n    // set timer\n    var timer = setTimeout(function(){\n      debug('connect attempt timed out after %d', timeout);\n      openSub.destroy();\n      socket.close();\n      socket.emit('error', 'timeout');\n      self.emitAll('connect_timeout', timeout);\n    }, timeout);\n\n    this.subs.push({\n      destroy: function(){\n        clearTimeout(timer);\n      }\n    });\n  }\n\n  this.subs.push(openSub);\n  this.subs.push(errorSub);\n\n  return this;\n};\n\n/**\n * Called upon transport open.\n *\n * @api private\n */\n\nManager.prototype.onopen = function(){\n  debug('open');\n\n  // clear old subs\n  this.cleanup();\n\n  // mark as open\n  this.readyState = 'open';\n  this.emit('open');\n\n  // add new subs\n  var socket = this.engine;\n  this.subs.push(on(socket, 'data', bind(this, 'ondata')));\n  this.subs.push(on(this.decoder, 'decoded', bind(this, 'ondecoded')));\n  this.subs.push(on(socket, 'error', bind(this, 'onerror')));\n  this.subs.push(on(socket, 'close', bind(this, 'onclose')));\n};\n\n/**\n * Called with data.\n *\n * @api private\n */\n\nManager.prototype.ondata = function(data){\n  this.decoder.add(data);\n};\n\n/**\n * Called when parser fully decodes a packet.\n *\n * @api private\n */\n\nManager.prototype.ondecoded = function(packet) {\n  this.emit('packet', packet);\n};\n\n/**\n * Called upon socket error.\n *\n * @api private\n */\n\nManager.prototype.onerror = function(err){\n  debug('error', err);\n  this.emitAll('error', err);\n};\n\n/**\n * Creates a new socket for the given `nsp`.\n *\n * @return {Socket}\n * @api public\n */\n\nManager.prototype.socket = function(nsp){\n  var socket = this.nsps[nsp];\n  if (!socket) {\n    socket = new Socket(this, nsp);\n    this.nsps[nsp] = socket;\n    var self = this;\n    socket.on('connect', function(){\n      socket.id = self.engine.id;\n      if (!~indexOf(self.connected, socket)) {\n        self.connected.push(socket);\n      }\n    });\n  }\n  return socket;\n};\n\n/**\n * Called upon a socket close.\n *\n * @param {Socket} socket\n */\n\nManager.prototype.destroy = function(socket){\n  var index = indexOf(this.connected, socket);\n  if (~index) this.connected.splice(index, 1);\n  if (this.connected.length) return;\n\n  this.close();\n};\n\n/**\n * Writes a packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nManager.prototype.packet = function(packet){\n  debug('writing packet %j', packet);\n  var self = this;\n\n  if (!self.encoding) {\n    // encode, then write to engine with result\n    self.encoding = true;\n    this.encoder.encode(packet, function(encodedPackets) {\n      for (var i = 0; i < encodedPackets.length; i++) {\n        self.engine.write(encodedPackets[i]);\n      }\n      self.encoding = false;\n      self.processPacketQueue();\n    });\n  } else { // add packet to the queue\n    self.packetBuffer.push(packet);\n  }\n};\n\n/**\n * If packet buffer is non-empty, begins encoding the\n * next packet in line.\n *\n * @api private\n */\n\nManager.prototype.processPacketQueue = function() {\n  if (this.packetBuffer.length > 0 && !this.encoding) {\n    var pack = this.packetBuffer.shift();\n    this.packet(pack);\n  }\n};\n\n/**\n * Clean up transport subscriptions and packet buffer.\n *\n * @api private\n */\n\nManager.prototype.cleanup = function(){\n  var sub;\n  while (sub = this.subs.shift()) sub.destroy();\n\n  this.packetBuffer = [];\n  this.encoding = false;\n\n  this.decoder.destroy();\n};\n\n/**\n * Close the current socket.\n *\n * @api private\n */\n\nManager.prototype.close =\nManager.prototype.disconnect = function(){\n  this.skipReconnect = true;\n  this.backoff.reset();\n  this.readyState = 'closed';\n  this.engine && this.engine.close();\n};\n\n/**\n * Called upon engine close.\n *\n * @api private\n */\n\nManager.prototype.onclose = function(reason){\n  debug('close');\n  this.cleanup();\n  this.backoff.reset();\n  this.readyState = 'closed';\n  this.emit('close', reason);\n  if (this._reconnection && !this.skipReconnect) {\n    this.reconnect();\n  }\n};\n\n/**\n * Attempt a reconnection.\n *\n * @api private\n */\n\nManager.prototype.reconnect = function(){\n  if (this.reconnecting || this.skipReconnect) return this;\n\n  var self = this;\n\n  if (this.backoff.attempts >= this._reconnectionAttempts) {\n    debug('reconnect failed');\n    this.backoff.reset();\n    this.emitAll('reconnect_failed');\n    this.reconnecting = false;\n  } else {\n    var delay = this.backoff.duration();\n    debug('will wait %dms before reconnect attempt', delay);\n\n    this.reconnecting = true;\n    var timer = setTimeout(function(){\n      if (self.skipReconnect) return;\n\n      debug('attempting reconnect');\n      self.emitAll('reconnect_attempt', self.backoff.attempts);\n      self.emitAll('reconnecting', self.backoff.attempts);\n\n      // check again for the case socket closed in above events\n      if (self.skipReconnect) return;\n\n      self.open(function(err){\n        if (err) {\n          debug('reconnect attempt error');\n          self.reconnecting = false;\n          self.reconnect();\n          self.emitAll('reconnect_error', err.data);\n        } else {\n          debug('reconnect success');\n          self.onreconnect();\n        }\n      });\n    }, delay);\n\n    this.subs.push({\n      destroy: function(){\n        clearTimeout(timer);\n      }\n    });\n  }\n};\n\n/**\n * Called upon successful reconnect.\n *\n * @api private\n */\n\nManager.prototype.onreconnect = function(){\n  var attempt = this.backoff.attempts;\n  this.reconnecting = false;\n  this.backoff.reset();\n  this.updateSocketIds();\n  this.emitAll('reconnect', attempt);\n};\n\n},{\"./on\":6,\"./socket\":7,\"./url\":8,\"backo2\":9,\"component-bind\":10,\"component-emitter\":11,\"debug\":12,\"engine.io-client\":13,\"indexof\":44,\"object-component\":45,\"socket.io-parser\":48}],6:[function(_dereq_,module,exports){\n\n/**\n * Module exports.\n */\n\nmodule.exports = on;\n\n/**\n * Helper for subscriptions.\n *\n * @param {Object|EventEmitter} obj with `Emitter` mixin or `EventEmitter`\n * @param {String} event name\n * @param {Function} callback\n * @api public\n */\n\nfunction on(obj, ev, fn) {\n  obj.on(ev, fn);\n  return {\n    destroy: function(){\n      obj.removeListener(ev, fn);\n    }\n  };\n}\n\n},{}],7:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar parser = _dereq_('socket.io-parser');\nvar Emitter = _dereq_('component-emitter');\nvar toArray = _dereq_('to-array');\nvar on = _dereq_('./on');\nvar bind = _dereq_('component-bind');\nvar debug = _dereq_('debug')('socket.io-client:socket');\nvar hasBin = _dereq_('has-binary');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = Socket;\n\n/**\n * Internal events (blacklisted).\n * These events can't be emitted by the user.\n *\n * @api private\n */\n\nvar events = {\n  connect: 1,\n  connect_error: 1,\n  connect_timeout: 1,\n  disconnect: 1,\n  error: 1,\n  reconnect: 1,\n  reconnect_attempt: 1,\n  reconnect_failed: 1,\n  reconnect_error: 1,\n  reconnecting: 1\n};\n\n/**\n * Shortcut to `Emitter#emit`.\n */\n\nvar emit = Emitter.prototype.emit;\n\n/**\n * `Socket` constructor.\n *\n * @api public\n */\n\nfunction Socket(io, nsp){\n  this.io = io;\n  this.nsp = nsp;\n  this.json = this; // compat\n  this.ids = 0;\n  this.acks = {};\n  if (this.io.autoConnect) this.open();\n  this.receiveBuffer = [];\n  this.sendBuffer = [];\n  this.connected = false;\n  this.disconnected = true;\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Socket.prototype);\n\n/**\n * Subscribe to open, close and packet events\n *\n * @api private\n */\n\nSocket.prototype.subEvents = function() {\n  if (this.subs) return;\n\n  var io = this.io;\n  this.subs = [\n    on(io, 'open', bind(this, 'onopen')),\n    on(io, 'packet', bind(this, 'onpacket')),\n    on(io, 'close', bind(this, 'onclose'))\n  ];\n};\n\n/**\n * \"Opens\" the socket.\n *\n * @api public\n */\n\nSocket.prototype.open =\nSocket.prototype.connect = function(){\n  if (this.connected) return this;\n\n  this.subEvents();\n  this.io.open(); // ensure open\n  if ('open' == this.io.readyState) this.onopen();\n  return this;\n};\n\n/**\n * Sends a `message` event.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.send = function(){\n  var args = toArray(arguments);\n  args.unshift('message');\n  this.emit.apply(this, args);\n  return this;\n};\n\n/**\n * Override `emit`.\n * If the event is in `events`, it's emitted normally.\n *\n * @param {String} event name\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.emit = function(ev){\n  if (events.hasOwnProperty(ev)) {\n    emit.apply(this, arguments);\n    return this;\n  }\n\n  var args = toArray(arguments);\n  var parserType = parser.EVENT; // default\n  if (hasBin(args)) { parserType = parser.BINARY_EVENT; } // binary\n  var packet = { type: parserType, data: args };\n\n  // event ack callback\n  if ('function' == typeof args[args.length - 1]) {\n    debug('emitting packet with ack id %d', this.ids);\n    this.acks[this.ids] = args.pop();\n    packet.id = this.ids++;\n  }\n\n  if (this.connected) {\n    this.packet(packet);\n  } else {\n    this.sendBuffer.push(packet);\n  }\n\n  return this;\n};\n\n/**\n * Sends a packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.packet = function(packet){\n  packet.nsp = this.nsp;\n  this.io.packet(packet);\n};\n\n/**\n * Called upon engine `open`.\n *\n * @api private\n */\n\nSocket.prototype.onopen = function(){\n  debug('transport is open - connecting');\n\n  // write connect packet if necessary\n  if ('/' != this.nsp) {\n    this.packet({ type: parser.CONNECT });\n  }\n};\n\n/**\n * Called upon engine `close`.\n *\n * @param {String} reason\n * @api private\n */\n\nSocket.prototype.onclose = function(reason){\n  debug('close (%s)', reason);\n  this.connected = false;\n  this.disconnected = true;\n  delete this.id;\n  this.emit('disconnect', reason);\n};\n\n/**\n * Called with socket packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onpacket = function(packet){\n  if (packet.nsp != this.nsp) return;\n\n  switch (packet.type) {\n    case parser.CONNECT:\n      this.onconnect();\n      break;\n\n    case parser.EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.BINARY_EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.ACK:\n      this.onack(packet);\n      break;\n\n    case parser.BINARY_ACK:\n      this.onack(packet);\n      break;\n\n    case parser.DISCONNECT:\n      this.ondisconnect();\n      break;\n\n    case parser.ERROR:\n      this.emit('error', packet.data);\n      break;\n  }\n};\n\n/**\n * Called upon a server event.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onevent = function(packet){\n  var args = packet.data || [];\n  debug('emitting event %j', args);\n\n  if (null != packet.id) {\n    debug('attaching ack callback to event');\n    args.push(this.ack(packet.id));\n  }\n\n  if (this.connected) {\n    emit.apply(this, args);\n  } else {\n    this.receiveBuffer.push(args);\n  }\n};\n\n/**\n * Produces an ack callback to emit with an event.\n *\n * @api private\n */\n\nSocket.prototype.ack = function(id){\n  var self = this;\n  var sent = false;\n  return function(){\n    // prevent double callbacks\n    if (sent) return;\n    sent = true;\n    var args = toArray(arguments);\n    debug('sending ack %j', args);\n\n    var type = hasBin(args) ? parser.BINARY_ACK : parser.ACK;\n    self.packet({\n      type: type,\n      id: id,\n      data: args\n    });\n  };\n};\n\n/**\n * Called upon a server acknowlegement.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onack = function(packet){\n  debug('calling ack %s with %j', packet.id, packet.data);\n  var fn = this.acks[packet.id];\n  fn.apply(this, packet.data);\n  delete this.acks[packet.id];\n};\n\n/**\n * Called upon server connect.\n *\n * @api private\n */\n\nSocket.prototype.onconnect = function(){\n  this.connected = true;\n  this.disconnected = false;\n  this.emit('connect');\n  this.emitBuffered();\n};\n\n/**\n * Emit buffered events (received and emitted).\n *\n * @api private\n */\n\nSocket.prototype.emitBuffered = function(){\n  var i;\n  for (i = 0; i < this.receiveBuffer.length; i++) {\n    emit.apply(this, this.receiveBuffer[i]);\n  }\n  this.receiveBuffer = [];\n\n  for (i = 0; i < this.sendBuffer.length; i++) {\n    this.packet(this.sendBuffer[i]);\n  }\n  this.sendBuffer = [];\n};\n\n/**\n * Called upon server disconnect.\n *\n * @api private\n */\n\nSocket.prototype.ondisconnect = function(){\n  debug('server disconnect (%s)', this.nsp);\n  this.destroy();\n  this.onclose('io server disconnect');\n};\n\n/**\n * Called upon forced client/server side disconnections,\n * this method ensures the manager stops tracking us and\n * that reconnections don't get triggered for this.\n *\n * @api private.\n */\n\nSocket.prototype.destroy = function(){\n  if (this.subs) {\n    // clean subscriptions to avoid reconnections\n    for (var i = 0; i < this.subs.length; i++) {\n      this.subs[i].destroy();\n    }\n    this.subs = null;\n  }\n\n  this.io.destroy(this);\n};\n\n/**\n * Disconnects the socket manually.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.close =\nSocket.prototype.disconnect = function(){\n  if (this.connected) {\n    debug('performing disconnect (%s)', this.nsp);\n    this.packet({ type: parser.DISCONNECT });\n  }\n\n  // remove socket from pool\n  this.destroy();\n\n  if (this.connected) {\n    // fire events\n    this.onclose('io client disconnect');\n  }\n  return this;\n};\n\n},{\"./on\":6,\"component-bind\":10,\"component-emitter\":11,\"debug\":12,\"has-binary\":42,\"socket.io-parser\":48,\"to-array\":52}],8:[function(_dereq_,module,exports){\n(function (global){\n\n/**\n * Module dependencies.\n */\n\nvar parseuri = _dereq_('parseuri');\nvar debug = _dereq_('debug')('socket.io-client:url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = url;\n\n/**\n * URL parser.\n *\n * @param {String} url\n * @param {Object} An object meant to mimic window.location.\n *                 Defaults to window.location.\n * @api public\n */\n\nfunction url(uri, loc){\n  var obj = uri;\n\n  // default to window.location\n  var loc = loc || global.location;\n  if (null == uri) uri = loc.protocol + '//' + loc.host;\n\n  // relative path support\n  if ('string' == typeof uri) {\n    if ('/' == uri.charAt(0)) {\n      if ('/' == uri.charAt(1)) {\n        uri = loc.protocol + uri;\n      } else {\n        uri = loc.hostname + uri;\n      }\n    }\n\n    if (!/^(https?|wss?):\\/\\//.test(uri)) {\n      debug('protocol-less url %s', uri);\n      if ('undefined' != typeof loc) {\n        uri = loc.protocol + '//' + uri;\n      } else {\n        uri = 'https://' + uri;\n      }\n    }\n\n    // parse\n    debug('parse %s', uri);\n    obj = parseuri(uri);\n  }\n\n  // make sure we treat `localhost:80` and `localhost` equally\n  if (!obj.port) {\n    if (/^(http|ws)$/.test(obj.protocol)) {\n      obj.port = '80';\n    }\n    else if (/^(http|ws)s$/.test(obj.protocol)) {\n      obj.port = '443';\n    }\n  }\n\n  obj.path = obj.path || '/';\n\n  // define unique id\n  obj.id = obj.protocol + '://' + obj.host + ':' + obj.port;\n  // define href\n  obj.href = obj.protocol + '://' + obj.host + (loc && loc.port == obj.port ? '' : (':' + obj.port));\n\n  return obj;\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"debug\":12,\"parseuri\":46}],9:[function(_dereq_,module,exports){\n\n/**\n * Expose `Backoff`.\n */\n\nmodule.exports = Backoff;\n\n/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction Backoff(opts) {\n  opts = opts || {};\n  this.ms = opts.min || 100;\n  this.max = opts.max || 10000;\n  this.factor = opts.factor || 2;\n  this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n  this.attempts = 0;\n}\n\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\n\nBackoff.prototype.duration = function(){\n  var ms = this.ms * Math.pow(this.factor, this.attempts++);\n  if (this.jitter) {\n    var rand =  Math.random();\n    var deviation = Math.floor(rand * this.jitter * ms);\n    ms = (Math.floor(rand * 10) & 1) == 0  ? ms - deviation : ms + deviation;\n  }\n  return Math.min(ms, this.max) | 0;\n};\n\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\n\nBackoff.prototype.reset = function(){\n  this.attempts = 0;\n};\n\n/**\n * Set the minimum duration\n *\n * @api public\n */\n\nBackoff.prototype.setMin = function(min){\n  this.ms = min;\n};\n\n/**\n * Set the maximum duration\n *\n * @api public\n */\n\nBackoff.prototype.setMax = function(max){\n  this.max = max;\n};\n\n/**\n * Set the jitter\n *\n * @api public\n */\n\nBackoff.prototype.setJitter = function(jitter){\n  this.jitter = jitter;\n};\n\n\n},{}],10:[function(_dereq_,module,exports){\n/**\n * Slice reference.\n */\n\nvar slice = [].slice;\n\n/**\n * Bind `obj` to `fn`.\n *\n * @param {Object} obj\n * @param {Function|String} fn or string\n * @return {Function}\n * @api public\n */\n\nmodule.exports = function(obj, fn){\n  if ('string' == typeof fn) fn = obj[fn];\n  if ('function' != typeof fn) throw new Error('bind() requires a function');\n  var args = slice.call(arguments, 2);\n  return function(){\n    return fn.apply(obj, args.concat(slice.call(arguments)));\n  }\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks[event] = this._callbacks[event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  var self = this;\n  this._callbacks = this._callbacks || {};\n\n  function on() {\n    self.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks[event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks[event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks[event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks[event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n\n},{}],12:[function(_dereq_,module,exports){\n\n/**\n * Expose `debug()` as the module.\n */\n\nmodule.exports = debug;\n\n/**\n * Create a debugger with the given `name`.\n *\n * @param {String} name\n * @return {Type}\n * @api public\n */\n\nfunction debug(name) {\n  if (!debug.enabled(name)) return function(){};\n\n  return function(fmt){\n    fmt = coerce(fmt);\n\n    var curr = new Date;\n    var ms = curr - (debug[name] || curr);\n    debug[name] = curr;\n\n    fmt = name\n      + ' '\n      + fmt\n      + ' +' + debug.humanize(ms);\n\n    // This hackery is required for IE8\n    // where `console.log` doesn't have 'apply'\n    window.console\n      && console.log\n      && Function.prototype.apply.call(console.log, console, arguments);\n  }\n}\n\n/**\n * The currently active debug mode names.\n */\n\ndebug.names = [];\ndebug.skips = [];\n\n/**\n * Enables a debug mode by name. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} name\n * @api public\n */\n\ndebug.enable = function(name) {\n  try {\n    localStorage.debug = name;\n  } catch(e){}\n\n  var split = (name || '').split(/[\\s,]+/)\n    , len = split.length;\n\n  for (var i = 0; i < len; i++) {\n    name = split[i].replace('*', '.*?');\n    if (name[0] === '-') {\n      debug.skips.push(new RegExp('^' + name.substr(1) + '$'));\n    }\n    else {\n      debug.names.push(new RegExp('^' + name + '$'));\n    }\n  }\n};\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\ndebug.disable = function(){\n  debug.enable('');\n};\n\n/**\n * Humanize the given `ms`.\n *\n * @param {Number} m\n * @return {String}\n * @api private\n */\n\ndebug.humanize = function(ms) {\n  var sec = 1000\n    , min = 60 * 1000\n    , hour = 60 * min;\n\n  if (ms >= hour) return (ms / hour).toFixed(1) + 'h';\n  if (ms >= min) return (ms / min).toFixed(1) + 'm';\n  if (ms >= sec) return (ms / sec | 0) + 's';\n  return ms + 'ms';\n};\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\ndebug.enabled = function(name) {\n  for (var i = 0, len = debug.skips.length; i < len; i++) {\n    if (debug.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (var i = 0, len = debug.names.length; i < len; i++) {\n    if (debug.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n * Coerce `val`.\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n\n// persist\n\ntry {\n  if (window.localStorage) debug.enable(localStorage.debug);\n} catch(e){}\n\n},{}],13:[function(_dereq_,module,exports){\n\nmodule.exports =  _dereq_('./lib/');\n\n},{\"./lib/\":14}],14:[function(_dereq_,module,exports){\n\nmodule.exports = _dereq_('./socket');\n\n/**\n * Exports parser\n *\n * @api public\n *\n */\nmodule.exports.parser = _dereq_('engine.io-parser');\n\n},{\"./socket\":15,\"engine.io-parser\":27}],15:[function(_dereq_,module,exports){\n(function (global){\n/**\n * Module dependencies.\n */\n\nvar transports = _dereq_('./transports');\nvar Emitter = _dereq_('component-emitter');\nvar debug = _dereq_('debug')('engine.io-client:socket');\nvar index = _dereq_('indexof');\nvar parser = _dereq_('engine.io-parser');\nvar parseuri = _dereq_('parseuri');\nvar parsejson = _dereq_('parsejson');\nvar parseqs = _dereq_('parseqs');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Socket;\n\n/**\n * Noop function.\n *\n * @api private\n */\n\nfunction noop(){}\n\n/**\n * Socket constructor.\n *\n * @param {String|Object} uri or options\n * @param {Object} options\n * @api public\n */\n\nfunction Socket(uri, opts){\n  if (!(this instanceof Socket)) return new Socket(uri, opts);\n\n  opts = opts || {};\n\n  if (uri && 'object' == typeof uri) {\n    opts = uri;\n    uri = null;\n  }\n\n  if (uri) {\n    uri = parseuri(uri);\n    opts.host = uri.host;\n    opts.secure = uri.protocol == 'https' || uri.protocol == 'wss';\n    opts.port = uri.port;\n    if (uri.query) opts.query = uri.query;\n  }\n\n  this.secure = null != opts.secure ? opts.secure :\n    (global.location && 'https:' == location.protocol);\n\n  if (opts.host) {\n    var pieces = opts.host.split(':');\n    opts.hostname = pieces.shift();\n    if (pieces.length) {\n      opts.port = pieces.pop();\n    } else if (!opts.port) {\n      // if no port is specified manually, use the protocol default\n      opts.port = this.secure ? '443' : '80';\n    }\n  }\n\n  this.agent = opts.agent || false;\n  this.hostname = opts.hostname ||\n    (global.location ? location.hostname : 'localhost');\n  this.port = opts.port || (global.location && location.port ?\n       location.port :\n       (this.secure ? 443 : 80));\n  this.query = opts.query || {};\n  if ('string' == typeof this.query) this.query = parseqs.decode(this.query);\n  this.upgrade = false !== opts.upgrade;\n  this.path = (opts.path || '/engine.io').replace(/\\/$/, '') + '/';\n  this.forceJSONP = !!opts.forceJSONP;\n  this.jsonp = false !== opts.jsonp;\n  this.forceBase64 = !!opts.forceBase64;\n  this.enablesXDR = !!opts.enablesXDR;\n  this.timestampParam = opts.timestampParam || 't';\n  this.timestampRequests = opts.timestampRequests;\n  this.transports = opts.transports || ['polling', 'websocket'];\n  this.readyState = '';\n  this.writeBuffer = [];\n  this.callbackBuffer = [];\n  this.policyPort = opts.policyPort || 843;\n  this.rememberUpgrade = opts.rememberUpgrade || false;\n  this.binaryType = null;\n  this.onlyBinaryUpgrades = opts.onlyBinaryUpgrades;\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx || null;\n  this.key = opts.key || null;\n  this.passphrase = opts.passphrase || null;\n  this.cert = opts.cert || null;\n  this.ca = opts.ca || null;\n  this.ciphers = opts.ciphers || null;\n  this.rejectUnauthorized = opts.rejectUnauthorized || null;\n\n  this.open();\n}\n\nSocket.priorWebsocketSuccess = false;\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Socket.prototype);\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nSocket.protocol = parser.protocol; // this is an int\n\n/**\n * Expose deps for legacy compatibility\n * and standalone browser access.\n */\n\nSocket.Socket = Socket;\nSocket.Transport = _dereq_('./transport');\nSocket.transports = _dereq_('./transports');\nSocket.parser = _dereq_('engine.io-parser');\n\n/**\n * Creates transport of the given type.\n *\n * @param {String} transport name\n * @return {Transport}\n * @api private\n */\n\nSocket.prototype.createTransport = function (name) {\n  debug('creating transport \"%s\"', name);\n  var query = clone(this.query);\n\n  // append engine.io protocol identifier\n  query.EIO = parser.protocol;\n\n  // transport name\n  query.transport = name;\n\n  // session id if we already have one\n  if (this.id) query.sid = this.id;\n\n  var transport = new transports[name]({\n    agent: this.agent,\n    hostname: this.hostname,\n    port: this.port,\n    secure: this.secure,\n    path: this.path,\n    query: query,\n    forceJSONP: this.forceJSONP,\n    jsonp: this.jsonp,\n    forceBase64: this.forceBase64,\n    enablesXDR: this.enablesXDR,\n    timestampRequests: this.timestampRequests,\n    timestampParam: this.timestampParam,\n    policyPort: this.policyPort,\n    socket: this,\n    pfx: this.pfx,\n    key: this.key,\n    passphrase: this.passphrase,\n    cert: this.cert,\n    ca: this.ca,\n    ciphers: this.ciphers,\n    rejectUnauthorized: this.rejectUnauthorized\n  });\n\n  return transport;\n};\n\nfunction clone (obj) {\n  var o = {};\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      o[i] = obj[i];\n    }\n  }\n  return o;\n}\n\n/**\n * Initializes transport to use and starts probe.\n *\n * @api private\n */\nSocket.prototype.open = function () {\n  var transport;\n  if (this.rememberUpgrade && Socket.priorWebsocketSuccess && this.transports.indexOf('websocket') != -1) {\n    transport = 'websocket';\n  } else if (0 == this.transports.length) {\n    // Emit error on next tick so it can be listened to\n    var self = this;\n    setTimeout(function() {\n      self.emit('error', 'No transports available');\n    }, 0);\n    return;\n  } else {\n    transport = this.transports[0];\n  }\n  this.readyState = 'opening';\n\n  // Retry with the next transport if the transport is disabled (jsonp: false)\n  var transport;\n  try {\n    transport = this.createTransport(transport);\n  } catch (e) {\n    this.transports.shift();\n    this.open();\n    return;\n  }\n\n  transport.open();\n  this.setTransport(transport);\n};\n\n/**\n * Sets the current transport. Disables the existing one (if any).\n *\n * @api private\n */\n\nSocket.prototype.setTransport = function(transport){\n  debug('setting transport %s', transport.name);\n  var self = this;\n\n  if (this.transport) {\n    debug('clearing existing transport %s', this.transport.name);\n    this.transport.removeAllListeners();\n  }\n\n  // set up transport\n  this.transport = transport;\n\n  // set up transport listeners\n  transport\n  .on('drain', function(){\n    self.onDrain();\n  })\n  .on('packet', function(packet){\n    self.onPacket(packet);\n  })\n  .on('error', function(e){\n    self.onError(e);\n  })\n  .on('close', function(){\n    self.onClose('transport close');\n  });\n};\n\n/**\n * Probes a transport.\n *\n * @param {String} transport name\n * @api private\n */\n\nSocket.prototype.probe = function (name) {\n  debug('probing transport \"%s\"', name);\n  var transport = this.createTransport(name, { probe: 1 })\n    , failed = false\n    , self = this;\n\n  Socket.priorWebsocketSuccess = false;\n\n  function onTransportOpen(){\n    if (self.onlyBinaryUpgrades) {\n      var upgradeLosesBinary = !this.supportsBinary && self.transport.supportsBinary;\n      failed = failed || upgradeLosesBinary;\n    }\n    if (failed) return;\n\n    debug('probe transport \"%s\" opened', name);\n    transport.send([{ type: 'ping', data: 'probe' }]);\n    transport.once('packet', function (msg) {\n      if (failed) return;\n      if ('pong' == msg.type && 'probe' == msg.data) {\n        debug('probe transport \"%s\" pong', name);\n        self.upgrading = true;\n        self.emit('upgrading', transport);\n        if (!transport) return;\n        Socket.priorWebsocketSuccess = 'websocket' == transport.name;\n\n        debug('pausing current transport \"%s\"', self.transport.name);\n        self.transport.pause(function () {\n          if (failed) return;\n          if ('closed' == self.readyState) return;\n          debug('changing transport and sending upgrade packet');\n\n          cleanup();\n\n          self.setTransport(transport);\n          transport.send([{ type: 'upgrade' }]);\n          self.emit('upgrade', transport);\n          transport = null;\n          self.upgrading = false;\n          self.flush();\n        });\n      } else {\n        debug('probe transport \"%s\" failed', name);\n        var err = new Error('probe error');\n        err.transport = transport.name;\n        self.emit('upgradeError', err);\n      }\n    });\n  }\n\n  function freezeTransport() {\n    if (failed) return;\n\n    // Any callback called by transport should be ignored since now\n    failed = true;\n\n    cleanup();\n\n    transport.close();\n    transport = null;\n  }\n\n  //Handle any error that happens while probing\n  function onerror(err) {\n    var error = new Error('probe error: ' + err);\n    error.transport = transport.name;\n\n    freezeTransport();\n\n    debug('probe transport \"%s\" failed because of error: %s', name, err);\n\n    self.emit('upgradeError', error);\n  }\n\n  function onTransportClose(){\n    onerror(\"transport closed\");\n  }\n\n  //When the socket is closed while we're probing\n  function onclose(){\n    onerror(\"socket closed\");\n  }\n\n  //When the socket is upgraded while we're probing\n  function onupgrade(to){\n    if (transport && to.name != transport.name) {\n      debug('\"%s\" works - aborting \"%s\"', to.name, transport.name);\n      freezeTransport();\n    }\n  }\n\n  //Remove all listeners on the transport and on self\n  function cleanup(){\n    transport.removeListener('open', onTransportOpen);\n    transport.removeListener('error', onerror);\n    transport.removeListener('close', onTransportClose);\n    self.removeListener('close', onclose);\n    self.removeListener('upgrading', onupgrade);\n  }\n\n  transport.once('open', onTransportOpen);\n  transport.once('error', onerror);\n  transport.once('close', onTransportClose);\n\n  this.once('close', onclose);\n  this.once('upgrading', onupgrade);\n\n  transport.open();\n\n};\n\n/**\n * Called when connection is deemed open.\n *\n * @api public\n */\n\nSocket.prototype.onOpen = function () {\n  debug('socket open');\n  this.readyState = 'open';\n  Socket.priorWebsocketSuccess = 'websocket' == this.transport.name;\n  this.emit('open');\n  this.flush();\n\n  // we check for `readyState` in case an `open`\n  // listener already closed the socket\n  if ('open' == this.readyState && this.upgrade && this.transport.pause) {\n    debug('starting upgrade probes');\n    for (var i = 0, l = this.upgrades.length; i < l; i++) {\n      this.probe(this.upgrades[i]);\n    }\n  }\n};\n\n/**\n * Handles a packet.\n *\n * @api private\n */\n\nSocket.prototype.onPacket = function (packet) {\n  if ('opening' == this.readyState || 'open' == this.readyState) {\n    debug('socket receive: type \"%s\", data \"%s\"', packet.type, packet.data);\n\n    this.emit('packet', packet);\n\n    // Socket is live - any packet counts\n    this.emit('heartbeat');\n\n    switch (packet.type) {\n      case 'open':\n        this.onHandshake(parsejson(packet.data));\n        break;\n\n      case 'pong':\n        this.setPing();\n        break;\n\n      case 'error':\n        var err = new Error('server error');\n        err.code = packet.data;\n        this.emit('error', err);\n        break;\n\n      case 'message':\n        this.emit('data', packet.data);\n        this.emit('message', packet.data);\n        break;\n    }\n  } else {\n    debug('packet received with socket readyState \"%s\"', this.readyState);\n  }\n};\n\n/**\n * Called upon handshake completion.\n *\n * @param {Object} handshake obj\n * @api private\n */\n\nSocket.prototype.onHandshake = function (data) {\n  this.emit('handshake', data);\n  this.id = data.sid;\n  this.transport.query.sid = data.sid;\n  this.upgrades = this.filterUpgrades(data.upgrades);\n  this.pingInterval = data.pingInterval;\n  this.pingTimeout = data.pingTimeout;\n  this.onOpen();\n  // In case open handler closes socket\n  if  ('closed' == this.readyState) return;\n  this.setPing();\n\n  // Prolong liveness of socket on heartbeat\n  this.removeListener('heartbeat', this.onHeartbeat);\n  this.on('heartbeat', this.onHeartbeat);\n};\n\n/**\n * Resets ping timeout.\n *\n * @api private\n */\n\nSocket.prototype.onHeartbeat = function (timeout) {\n  clearTimeout(this.pingTimeoutTimer);\n  var self = this;\n  self.pingTimeoutTimer = setTimeout(function () {\n    if ('closed' == self.readyState) return;\n    self.onClose('ping timeout');\n  }, timeout || (self.pingInterval + self.pingTimeout));\n};\n\n/**\n * Pings server every `this.pingInterval` and expects response\n * within `this.pingTimeout` or closes connection.\n *\n * @api private\n */\n\nSocket.prototype.setPing = function () {\n  var self = this;\n  clearTimeout(self.pingIntervalTimer);\n  self.pingIntervalTimer = setTimeout(function () {\n    debug('writing ping packet - expecting pong within %sms', self.pingTimeout);\n    self.ping();\n    self.onHeartbeat(self.pingTimeout);\n  }, self.pingInterval);\n};\n\n/**\n* Sends a ping packet.\n*\n* @api public\n*/\n\nSocket.prototype.ping = function () {\n  this.sendPacket('ping');\n};\n\n/**\n * Called on `drain` event\n *\n * @api private\n */\n\nSocket.prototype.onDrain = function() {\n  for (var i = 0; i < this.prevBufferLen; i++) {\n    if (this.callbackBuffer[i]) {\n      this.callbackBuffer[i]();\n    }\n  }\n\n  this.writeBuffer.splice(0, this.prevBufferLen);\n  this.callbackBuffer.splice(0, this.prevBufferLen);\n\n  // setting prevBufferLen = 0 is very important\n  // for example, when upgrading, upgrade packet is sent over,\n  // and a nonzero prevBufferLen could cause problems on `drain`\n  this.prevBufferLen = 0;\n\n  if (this.writeBuffer.length == 0) {\n    this.emit('drain');\n  } else {\n    this.flush();\n  }\n};\n\n/**\n * Flush write buffers.\n *\n * @api private\n */\n\nSocket.prototype.flush = function () {\n  if ('closed' != this.readyState && this.transport.writable &&\n    !this.upgrading && this.writeBuffer.length) {\n    debug('flushing %d packets in socket', this.writeBuffer.length);\n    this.transport.send(this.writeBuffer);\n    // keep track of current length of writeBuffer\n    // splice writeBuffer and callbackBuffer on `drain`\n    this.prevBufferLen = this.writeBuffer.length;\n    this.emit('flush');\n  }\n};\n\n/**\n * Sends a message.\n *\n * @param {String} message.\n * @param {Function} callback function.\n * @return {Socket} for chaining.\n * @api public\n */\n\nSocket.prototype.write =\nSocket.prototype.send = function (msg, fn) {\n  this.sendPacket('message', msg, fn);\n  return this;\n};\n\n/**\n * Sends a packet.\n *\n * @param {String} packet type.\n * @param {String} data.\n * @param {Function} callback function.\n * @api private\n */\n\nSocket.prototype.sendPacket = function (type, data, fn) {\n  if ('closing' == this.readyState || 'closed' == this.readyState) {\n    return;\n  }\n\n  var packet = { type: type, data: data };\n  this.emit('packetCreate', packet);\n  this.writeBuffer.push(packet);\n  this.callbackBuffer.push(fn);\n  this.flush();\n};\n\n/**\n * Closes the connection.\n *\n * @api private\n */\n\nSocket.prototype.close = function () {\n  if ('opening' == this.readyState || 'open' == this.readyState) {\n    this.readyState = 'closing';\n\n    var self = this;\n\n    function close() {\n      self.onClose('forced close');\n      debug('socket closing - telling transport to close');\n      self.transport.close();\n    }\n\n    function cleanupAndClose() {\n      self.removeListener('upgrade', cleanupAndClose);\n      self.removeListener('upgradeError', cleanupAndClose);\n      close();\n    }\n\n    function waitForUpgrade() {\n      // wait for upgrade to finish since we can't send packets while pausing a transport\n      self.once('upgrade', cleanupAndClose);\n      self.once('upgradeError', cleanupAndClose);\n    }\n\n    if (this.writeBuffer.length) {\n      this.once('drain', function() {\n        if (this.upgrading) {\n          waitForUpgrade();\n        } else {\n          close();\n        }\n      });\n    } else if (this.upgrading) {\n      waitForUpgrade();\n    } else {\n      close();\n    }\n  }\n\n  return this;\n};\n\n/**\n * Called upon transport error\n *\n * @api private\n */\n\nSocket.prototype.onError = function (err) {\n  debug('socket error %j', err);\n  Socket.priorWebsocketSuccess = false;\n  this.emit('error', err);\n  this.onClose('transport error', err);\n};\n\n/**\n * Called upon transport close.\n *\n * @api private\n */\n\nSocket.prototype.onClose = function (reason, desc) {\n  if ('opening' == this.readyState || 'open' == this.readyState || 'closing' == this.readyState) {\n    debug('socket close with reason: \"%s\"', reason);\n    var self = this;\n\n    // clear timers\n    clearTimeout(this.pingIntervalTimer);\n    clearTimeout(this.pingTimeoutTimer);\n\n    // clean buffers in next tick, so developers can still\n    // grab the buffers on `close` event\n    setTimeout(function() {\n      self.writeBuffer = [];\n      self.callbackBuffer = [];\n      self.prevBufferLen = 0;\n    }, 0);\n\n    // stop event from firing again for transport\n    this.transport.removeAllListeners('close');\n\n    // ensure transport won't stay open\n    this.transport.close();\n\n    // ignore further transport communication\n    this.transport.removeAllListeners();\n\n    // set ready state\n    this.readyState = 'closed';\n\n    // clear session id\n    this.id = null;\n\n    // emit close event\n    this.emit('close', reason, desc);\n  }\n};\n\n/**\n * Filters upgrades, returning only those matching client transports.\n *\n * @param {Array} server upgrades\n * @api private\n *\n */\n\nSocket.prototype.filterUpgrades = function (upgrades) {\n  var filteredUpgrades = [];\n  for (var i = 0, j = upgrades.length; i<j; i++) {\n    if (~index(this.transports, upgrades[i])) filteredUpgrades.push(upgrades[i]);\n  }\n  return filteredUpgrades;\n};\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./transport\":16,\"./transports\":17,\"component-emitter\":11,\"debug\":24,\"engine.io-parser\":27,\"indexof\":44,\"parsejson\":38,\"parseqs\":39,\"parseuri\":40}],16:[function(_dereq_,module,exports){\n/**\n * Module dependencies.\n */\n\nvar parser = _dereq_('engine.io-parser');\nvar Emitter = _dereq_('component-emitter');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Transport;\n\n/**\n * Transport abstract constructor.\n *\n * @param {Object} options.\n * @api private\n */\n\nfunction Transport (opts) {\n  this.path = opts.path;\n  this.hostname = opts.hostname;\n  this.port = opts.port;\n  this.secure = opts.secure;\n  this.query = opts.query;\n  this.timestampParam = opts.timestampParam;\n  this.timestampRequests = opts.timestampRequests;\n  this.readyState = '';\n  this.agent = opts.agent || false;\n  this.socket = opts.socket;\n  this.enablesXDR = opts.enablesXDR;\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx;\n  this.key = opts.key;\n  this.passphrase = opts.passphrase;\n  this.cert = opts.cert;\n  this.ca = opts.ca;\n  this.ciphers = opts.ciphers;\n  this.rejectUnauthorized = opts.rejectUnauthorized;\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Transport.prototype);\n\n/**\n * A counter used to prevent collisions in the timestamps used\n * for cache busting.\n */\n\nTransport.timestamps = 0;\n\n/**\n * Emits an error.\n *\n * @param {String} str\n * @return {Transport} for chaining\n * @api public\n */\n\nTransport.prototype.onError = function (msg, desc) {\n  var err = new Error(msg);\n  err.type = 'TransportError';\n  err.description = desc;\n  this.emit('error', err);\n  return this;\n};\n\n/**\n * Opens the transport.\n *\n * @api public\n */\n\nTransport.prototype.open = function () {\n  if ('closed' == this.readyState || '' == this.readyState) {\n    this.readyState = 'opening';\n    this.doOpen();\n  }\n\n  return this;\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nTransport.prototype.close = function () {\n  if ('opening' == this.readyState || 'open' == this.readyState) {\n    this.doClose();\n    this.onClose();\n  }\n\n  return this;\n};\n\n/**\n * Sends multiple packets.\n *\n * @param {Array} packets\n * @api private\n */\n\nTransport.prototype.send = function(packets){\n  if ('open' == this.readyState) {\n    this.write(packets);\n  } else {\n    throw new Error('Transport not open');\n  }\n};\n\n/**\n * Called upon open\n *\n * @api private\n */\n\nTransport.prototype.onOpen = function () {\n  this.readyState = 'open';\n  this.writable = true;\n  this.emit('open');\n};\n\n/**\n * Called with data.\n *\n * @param {String} data\n * @api private\n */\n\nTransport.prototype.onData = function(data){\n  var packet = parser.decodePacket(data, this.socket.binaryType);\n  this.onPacket(packet);\n};\n\n/**\n * Called with a decoded packet.\n */\n\nTransport.prototype.onPacket = function (packet) {\n  this.emit('packet', packet);\n};\n\n/**\n * Called upon close.\n *\n * @api private\n */\n\nTransport.prototype.onClose = function () {\n  this.readyState = 'closed';\n  this.emit('close');\n};\n\n},{\"component-emitter\":11,\"engine.io-parser\":27}],17:[function(_dereq_,module,exports){\n(function (global){\n/**\n * Module dependencies\n */\n\nvar XMLHttpRequest = _dereq_('xmlhttprequest');\nvar XHR = _dereq_('./polling-xhr');\nvar JSONP = _dereq_('./polling-jsonp');\nvar websocket = _dereq_('./websocket');\n\n/**\n * Export transports.\n */\n\nexports.polling = polling;\nexports.websocket = websocket;\n\n/**\n * Polling transport polymorphic constructor.\n * Decides on xhr vs jsonp based on feature detection.\n *\n * @api private\n */\n\nfunction polling(opts){\n  var xhr;\n  var xd = false;\n  var xs = false;\n  var jsonp = false !== opts.jsonp;\n\n  if (global.location) {\n    var isSSL = 'https:' == location.protocol;\n    var port = location.port;\n\n    // some user agents have empty `location.port`\n    if (!port) {\n      port = isSSL ? 443 : 80;\n    }\n\n    xd = opts.hostname != location.hostname || port != opts.port;\n    xs = opts.secure != isSSL;\n  }\n\n  opts.xdomain = xd;\n  opts.xscheme = xs;\n  xhr = new XMLHttpRequest(opts);\n\n  if ('open' in xhr && !opts.forceJSONP) {\n    return new XHR(opts);\n  } else {\n    if (!jsonp) throw new Error('JSONP disabled');\n    return new JSONP(opts);\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./polling-jsonp\":18,\"./polling-xhr\":19,\"./websocket\":21,\"xmlhttprequest\":22}],18:[function(_dereq_,module,exports){\n(function (global){\n\n/**\n * Module requirements.\n */\n\nvar Polling = _dereq_('./polling');\nvar inherit = _dereq_('component-inherit');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONPPolling;\n\n/**\n * Cached regular expressions.\n */\n\nvar rNewline = /\\n/g;\nvar rEscapedNewline = /\\\\n/g;\n\n/**\n * Global JSONP callbacks.\n */\n\nvar callbacks;\n\n/**\n * Callbacks count.\n */\n\nvar index = 0;\n\n/**\n * Noop.\n */\n\nfunction empty () { }\n\n/**\n * JSONP Polling constructor.\n *\n * @param {Object} opts.\n * @api public\n */\n\nfunction JSONPPolling (opts) {\n  Polling.call(this, opts);\n\n  this.query = this.query || {};\n\n  // define global callbacks array if not present\n  // we do this here (lazily) to avoid unneeded global pollution\n  if (!callbacks) {\n    // we need to consider multiple engines in the same page\n    if (!global.___eio) global.___eio = [];\n    callbacks = global.___eio;\n  }\n\n  // callback identifier\n  this.index = callbacks.length;\n\n  // add callback to jsonp global\n  var self = this;\n  callbacks.push(function (msg) {\n    self.onData(msg);\n  });\n\n  // append to query string\n  this.query.j = this.index;\n\n  // prevent spurious errors from being emitted when the window is unloaded\n  if (global.document && global.addEventListener) {\n    global.addEventListener('beforeunload', function () {\n      if (self.script) self.script.onerror = empty;\n    }, false);\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(JSONPPolling, Polling);\n\n/*\n * JSONP only supports binary as base64 encoded strings\n */\n\nJSONPPolling.prototype.supportsBinary = false;\n\n/**\n * Closes the socket.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doClose = function () {\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  if (this.form) {\n    this.form.parentNode.removeChild(this.form);\n    this.form = null;\n    this.iframe = null;\n  }\n\n  Polling.prototype.doClose.call(this);\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doPoll = function () {\n  var self = this;\n  var script = document.createElement('script');\n\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  script.async = true;\n  script.src = this.uri();\n  script.onerror = function(e){\n    self.onError('jsonp poll error',e);\n  };\n\n  var insertAt = document.getElementsByTagName('script')[0];\n  insertAt.parentNode.insertBefore(script, insertAt);\n  this.script = script;\n\n  var isUAgecko = 'undefined' != typeof navigator && /gecko/i.test(navigator.userAgent);\n  \n  if (isUAgecko) {\n    setTimeout(function () {\n      var iframe = document.createElement('iframe');\n      document.body.appendChild(iframe);\n      document.body.removeChild(iframe);\n    }, 100);\n  }\n};\n\n/**\n * Writes with a hidden iframe.\n *\n * @param {String} data to send\n * @param {Function} called upon flush.\n * @api private\n */\n\nJSONPPolling.prototype.doWrite = function (data, fn) {\n  var self = this;\n\n  if (!this.form) {\n    var form = document.createElement('form');\n    var area = document.createElement('textarea');\n    var id = this.iframeId = 'eio_iframe_' + this.index;\n    var iframe;\n\n    form.className = 'socketio';\n    form.style.position = 'absolute';\n    form.style.top = '-1000px';\n    form.style.left = '-1000px';\n    form.target = id;\n    form.method = 'POST';\n    form.setAttribute('accept-charset', 'utf-8');\n    area.name = 'd';\n    form.appendChild(area);\n    document.body.appendChild(form);\n\n    this.form = form;\n    this.area = area;\n  }\n\n  this.form.action = this.uri();\n\n  function complete () {\n    initIframe();\n    fn();\n  }\n\n  function initIframe () {\n    if (self.iframe) {\n      try {\n        self.form.removeChild(self.iframe);\n      } catch (e) {\n        self.onError('jsonp polling iframe removal error', e);\n      }\n    }\n\n    try {\n      // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n      var html = '<iframe src=\"javascript:0\" name=\"'+ self.iframeId +'\">';\n      iframe = document.createElement(html);\n    } catch (e) {\n      iframe = document.createElement('iframe');\n      iframe.name = self.iframeId;\n      iframe.src = 'javascript:0';\n    }\n\n    iframe.id = self.iframeId;\n\n    self.form.appendChild(iframe);\n    self.iframe = iframe;\n  }\n\n  initIframe();\n\n  // escape \\n to prevent it from being converted into \\r\\n by some UAs\n  // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\n  data = data.replace(rEscapedNewline, '\\\\\\n');\n  this.area.value = data.replace(rNewline, '\\\\n');\n\n  try {\n    this.form.submit();\n  } catch(e) {}\n\n  if (this.iframe.attachEvent) {\n    this.iframe.onreadystatechange = function(){\n      if (self.iframe.readyState == 'complete') {\n        complete();\n      }\n    };\n  } else {\n    this.iframe.onload = complete;\n  }\n};\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./polling\":20,\"component-inherit\":23}],19:[function(_dereq_,module,exports){\n(function (global){\n/**\n * Module requirements.\n */\n\nvar XMLHttpRequest = _dereq_('xmlhttprequest');\nvar Polling = _dereq_('./polling');\nvar Emitter = _dereq_('component-emitter');\nvar inherit = _dereq_('component-inherit');\nvar debug = _dereq_('debug')('engine.io-client:polling-xhr');\n\n/**\n * Module exports.\n */\n\nmodule.exports = XHR;\nmodule.exports.Request = Request;\n\n/**\n * Empty function\n */\n\nfunction empty(){}\n\n/**\n * XHR Polling constructor.\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction XHR(opts){\n  Polling.call(this, opts);\n\n  if (global.location) {\n    var isSSL = 'https:' == location.protocol;\n    var port = location.port;\n\n    // some user agents have empty `location.port`\n    if (!port) {\n      port = isSSL ? 443 : 80;\n    }\n\n    this.xd = opts.hostname != global.location.hostname ||\n      port != opts.port;\n    this.xs = opts.secure != isSSL;\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(XHR, Polling);\n\n/**\n * XHR supports binary\n */\n\nXHR.prototype.supportsBinary = true;\n\n/**\n * Creates a request.\n *\n * @param {String} method\n * @api private\n */\n\nXHR.prototype.request = function(opts){\n  opts = opts || {};\n  opts.uri = this.uri();\n  opts.xd = this.xd;\n  opts.xs = this.xs;\n  opts.agent = this.agent || false;\n  opts.supportsBinary = this.supportsBinary;\n  opts.enablesXDR = this.enablesXDR;\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n\n  return new Request(opts);\n};\n\n/**\n * Sends data.\n *\n * @param {String} data to send.\n * @param {Function} called upon flush.\n * @api private\n */\n\nXHR.prototype.doWrite = function(data, fn){\n  var isBinary = typeof data !== 'string' && data !== undefined;\n  var req = this.request({ method: 'POST', data: data, isBinary: isBinary });\n  var self = this;\n  req.on('success', fn);\n  req.on('error', function(err){\n    self.onError('xhr post error', err);\n  });\n  this.sendXhr = req;\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nXHR.prototype.doPoll = function(){\n  debug('xhr poll');\n  var req = this.request();\n  var self = this;\n  req.on('data', function(data){\n    self.onData(data);\n  });\n  req.on('error', function(err){\n    self.onError('xhr poll error', err);\n  });\n  this.pollXhr = req;\n};\n\n/**\n * Request constructor\n *\n * @param {Object} options\n * @api public\n */\n\nfunction Request(opts){\n  this.method = opts.method || 'GET';\n  this.uri = opts.uri;\n  this.xd = !!opts.xd;\n  this.xs = !!opts.xs;\n  this.async = false !== opts.async;\n  this.data = undefined != opts.data ? opts.data : null;\n  this.agent = opts.agent;\n  this.isBinary = opts.isBinary;\n  this.supportsBinary = opts.supportsBinary;\n  this.enablesXDR = opts.enablesXDR;\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx;\n  this.key = opts.key;\n  this.passphrase = opts.passphrase;\n  this.cert = opts.cert;\n  this.ca = opts.ca;\n  this.ciphers = opts.ciphers;\n  this.rejectUnauthorized = opts.rejectUnauthorized;\n\n  this.create();\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Request.prototype);\n\n/**\n * Creates the XHR object and sends the request.\n *\n * @api private\n */\n\nRequest.prototype.create = function(){\n  var opts = { agent: this.agent, xdomain: this.xd, xscheme: this.xs, enablesXDR: this.enablesXDR };\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n\n  var xhr = this.xhr = new XMLHttpRequest(opts);\n  var self = this;\n\n  try {\n    debug('xhr open %s: %s', this.method, this.uri);\n    xhr.open(this.method, this.uri, this.async);\n    if (this.supportsBinary) {\n      // This has to be done after open because Firefox is stupid\n      // http://stackoverflow.com/questions/13216903/get-binary-data-with-xmlhttprequest-in-a-firefox-extension\n      xhr.responseType = 'arraybuffer';\n    }\n\n    if ('POST' == this.method) {\n      try {\n        if (this.isBinary) {\n          xhr.setRequestHeader('Content-type', 'application/octet-stream');\n        } else {\n          xhr.setRequestHeader('Content-type', 'text/plain;charset=UTF-8');\n        }\n      } catch (e) {}\n    }\n\n    // ie6 check\n    if ('withCredentials' in xhr) {\n      xhr.withCredentials = true;\n    }\n\n    if (this.hasXDR()) {\n      xhr.onload = function(){\n        self.onLoad();\n      };\n      xhr.onerror = function(){\n        self.onError(xhr.responseText);\n      };\n    } else {\n      xhr.onreadystatechange = function(){\n        if (4 != xhr.readyState) return;\n        if (200 == xhr.status || 1223 == xhr.status) {\n          self.onLoad();\n        } else {\n          // make sure the `error` event handler that's user-set\n          // does not throw in the same tick and gets caught here\n          setTimeout(function(){\n            self.onError(xhr.status);\n          }, 0);\n        }\n      };\n    }\n\n    debug('xhr data %s', this.data);\n    xhr.send(this.data);\n  } catch (e) {\n    // Need to defer since .create() is called directly fhrom the constructor\n    // and thus the 'error' event can only be only bound *after* this exception\n    // occurs.  Therefore, also, we cannot throw here at all.\n    setTimeout(function() {\n      self.onError(e);\n    }, 0);\n    return;\n  }\n\n  if (global.document) {\n    this.index = Request.requestsCount++;\n    Request.requests[this.index] = this;\n  }\n};\n\n/**\n * Called upon successful response.\n *\n * @api private\n */\n\nRequest.prototype.onSuccess = function(){\n  this.emit('success');\n  this.cleanup();\n};\n\n/**\n * Called if we have data.\n *\n * @api private\n */\n\nRequest.prototype.onData = function(data){\n  this.emit('data', data);\n  this.onSuccess();\n};\n\n/**\n * Called upon error.\n *\n * @api private\n */\n\nRequest.prototype.onError = function(err){\n  this.emit('error', err);\n  this.cleanup(true);\n};\n\n/**\n * Cleans up house.\n *\n * @api private\n */\n\nRequest.prototype.cleanup = function(fromError){\n  if ('undefined' == typeof this.xhr || null === this.xhr) {\n    return;\n  }\n  // xmlhttprequest\n  if (this.hasXDR()) {\n    this.xhr.onload = this.xhr.onerror = empty;\n  } else {\n    this.xhr.onreadystatechange = empty;\n  }\n\n  if (fromError) {\n    try {\n      this.xhr.abort();\n    } catch(e) {}\n  }\n\n  if (global.document) {\n    delete Request.requests[this.index];\n  }\n\n  this.xhr = null;\n};\n\n/**\n * Called upon load.\n *\n * @api private\n */\n\nRequest.prototype.onLoad = function(){\n  var data;\n  try {\n    var contentType;\n    try {\n      contentType = this.xhr.getResponseHeader('Content-Type').split(';')[0];\n    } catch (e) {}\n    if (contentType === 'application/octet-stream') {\n      data = this.xhr.response;\n    } else {\n      if (!this.supportsBinary) {\n        data = this.xhr.responseText;\n      } else {\n        data = 'ok';\n      }\n    }\n  } catch (e) {\n    this.onError(e);\n  }\n  if (null != data) {\n    this.onData(data);\n  }\n};\n\n/**\n * Check if it has XDomainRequest.\n *\n * @api private\n */\n\nRequest.prototype.hasXDR = function(){\n  return 'undefined' !== typeof global.XDomainRequest && !this.xs && this.enablesXDR;\n};\n\n/**\n * Aborts the request.\n *\n * @api public\n */\n\nRequest.prototype.abort = function(){\n  this.cleanup();\n};\n\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\n\nif (global.document) {\n  Request.requestsCount = 0;\n  Request.requests = {};\n  if (global.attachEvent) {\n    global.attachEvent('onunload', unloadHandler);\n  } else if (global.addEventListener) {\n    global.addEventListener('beforeunload', unloadHandler, false);\n  }\n}\n\nfunction unloadHandler() {\n  for (var i in Request.requests) {\n    if (Request.requests.hasOwnProperty(i)) {\n      Request.requests[i].abort();\n    }\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./polling\":20,\"component-emitter\":11,\"component-inherit\":23,\"debug\":24,\"xmlhttprequest\":22}],20:[function(_dereq_,module,exports){\n/**\n * Module dependencies.\n */\n\nvar Transport = _dereq_('../transport');\nvar parseqs = _dereq_('parseqs');\nvar parser = _dereq_('engine.io-parser');\nvar inherit = _dereq_('component-inherit');\nvar debug = _dereq_('debug')('engine.io-client:polling');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Polling;\n\n/**\n * Is XHR2 supported?\n */\n\nvar hasXHR2 = (function() {\n  var XMLHttpRequest = _dereq_('xmlhttprequest');\n  var xhr = new XMLHttpRequest({ xdomain: false });\n  return null != xhr.responseType;\n})();\n\n/**\n * Polling interface.\n *\n * @param {Object} opts\n * @api private\n */\n\nfunction Polling(opts){\n  var forceBase64 = (opts && opts.forceBase64);\n  if (!hasXHR2 || forceBase64) {\n    this.supportsBinary = false;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(Polling, Transport);\n\n/**\n * Transport name.\n */\n\nPolling.prototype.name = 'polling';\n\n/**\n * Opens the socket (triggers polling). We write a PING message to determine\n * when the transport is open.\n *\n * @api private\n */\n\nPolling.prototype.doOpen = function(){\n  this.poll();\n};\n\n/**\n * Pauses polling.\n *\n * @param {Function} callback upon buffers are flushed and transport is paused\n * @api private\n */\n\nPolling.prototype.pause = function(onPause){\n  var pending = 0;\n  var self = this;\n\n  this.readyState = 'pausing';\n\n  function pause(){\n    debug('paused');\n    self.readyState = 'paused';\n    onPause();\n  }\n\n  if (this.polling || !this.writable) {\n    var total = 0;\n\n    if (this.polling) {\n      debug('we are currently polling - waiting to pause');\n      total++;\n      this.once('pollComplete', function(){\n        debug('pre-pause polling complete');\n        --total || pause();\n      });\n    }\n\n    if (!this.writable) {\n      debug('we are currently writing - waiting to pause');\n      total++;\n      this.once('drain', function(){\n        debug('pre-pause writing complete');\n        --total || pause();\n      });\n    }\n  } else {\n    pause();\n  }\n};\n\n/**\n * Starts polling cycle.\n *\n * @api public\n */\n\nPolling.prototype.poll = function(){\n  debug('polling');\n  this.polling = true;\n  this.doPoll();\n  this.emit('poll');\n};\n\n/**\n * Overloads onData to detect payloads.\n *\n * @api private\n */\n\nPolling.prototype.onData = function(data){\n  var self = this;\n  debug('polling got data %s', data);\n  var callback = function(packet, index, total) {\n    // if its the first message we consider the transport open\n    if ('opening' == self.readyState) {\n      self.onOpen();\n    }\n\n    // if its a close packet, we close the ongoing requests\n    if ('close' == packet.type) {\n      self.onClose();\n      return false;\n    }\n\n    // otherwise bypass onData and handle the message\n    self.onPacket(packet);\n  };\n\n  // decode payload\n  parser.decodePayload(data, this.socket.binaryType, callback);\n\n  // if an event did not trigger closing\n  if ('closed' != this.readyState) {\n    // if we got data we're not polling\n    this.polling = false;\n    this.emit('pollComplete');\n\n    if ('open' == this.readyState) {\n      this.poll();\n    } else {\n      debug('ignoring poll - transport state \"%s\"', this.readyState);\n    }\n  }\n};\n\n/**\n * For polling, send a close packet.\n *\n * @api private\n */\n\nPolling.prototype.doClose = function(){\n  var self = this;\n\n  function close(){\n    debug('writing close packet');\n    self.write([{ type: 'close' }]);\n  }\n\n  if ('open' == this.readyState) {\n    debug('transport open - closing');\n    close();\n  } else {\n    // in case we're trying to close while\n    // handshaking is in progress (GH-164)\n    debug('transport not open - deferring close');\n    this.once('open', close);\n  }\n};\n\n/**\n * Writes a packets payload.\n *\n * @param {Array} data packets\n * @param {Function} drain callback\n * @api private\n */\n\nPolling.prototype.write = function(packets){\n  var self = this;\n  this.writable = false;\n  var callbackfn = function() {\n    self.writable = true;\n    self.emit('drain');\n  };\n\n  var self = this;\n  parser.encodePayload(packets, this.supportsBinary, function(data) {\n    self.doWrite(data, callbackfn);\n  });\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nPolling.prototype.uri = function(){\n  var query = this.query || {};\n  var schema = this.secure ? 'https' : 'http';\n  var port = '';\n\n  // cache busting is forced\n  if (false !== this.timestampRequests) {\n    query[this.timestampParam] = +new Date + '-' + Transport.timestamps++;\n  }\n\n  if (!this.supportsBinary && !query.sid) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // avoid port if default for schema\n  if (this.port && (('https' == schema && this.port != 443) ||\n     ('http' == schema && this.port != 80))) {\n    port = ':' + this.port;\n  }\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  return schema + '://' + this.hostname + port + this.path + query;\n};\n\n},{\"../transport\":16,\"component-inherit\":23,\"debug\":24,\"engine.io-parser\":27,\"parseqs\":39,\"xmlhttprequest\":22}],21:[function(_dereq_,module,exports){\n/**\n * Module dependencies.\n */\n\nvar Transport = _dereq_('../transport');\nvar parser = _dereq_('engine.io-parser');\nvar parseqs = _dereq_('parseqs');\nvar inherit = _dereq_('component-inherit');\nvar debug = _dereq_('debug')('engine.io-client:websocket');\n\n/**\n * `ws` exposes a WebSocket-compatible interface in\n * Node, or the `WebSocket` or `MozWebSocket` globals\n * in the browser.\n */\n\nvar WebSocket = _dereq_('ws');\n\n/**\n * Module exports.\n */\n\nmodule.exports = WS;\n\n/**\n * WebSocket transport constructor.\n *\n * @api {Object} connection options\n * @api public\n */\n\nfunction WS(opts){\n  var forceBase64 = (opts && opts.forceBase64);\n  if (forceBase64) {\n    this.supportsBinary = false;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(WS, Transport);\n\n/**\n * Transport name.\n *\n * @api public\n */\n\nWS.prototype.name = 'websocket';\n\n/*\n * WebSockets support binary\n */\n\nWS.prototype.supportsBinary = true;\n\n/**\n * Opens socket.\n *\n * @api private\n */\n\nWS.prototype.doOpen = function(){\n  if (!this.check()) {\n    // let probe timeout\n    return;\n  }\n\n  var self = this;\n  var uri = this.uri();\n  var protocols = void(0);\n  var opts = { agent: this.agent };\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n\n  this.ws = new WebSocket(uri, protocols, opts);\n\n  if (this.ws.binaryType === undefined) {\n    this.supportsBinary = false;\n  }\n\n  this.ws.binaryType = 'arraybuffer';\n  this.addEventListeners();\n};\n\n/**\n * Adds event listeners to the socket\n *\n * @api private\n */\n\nWS.prototype.addEventListeners = function(){\n  var self = this;\n\n  this.ws.onopen = function(){\n    self.onOpen();\n  };\n  this.ws.onclose = function(){\n    self.onClose();\n  };\n  this.ws.onmessage = function(ev){\n    self.onData(ev.data);\n  };\n  this.ws.onerror = function(e){\n    self.onError('websocket error', e);\n  };\n};\n\n/**\n * Override `onData` to use a timer on iOS.\n * See: https://gist.github.com/mloughran/2052006\n *\n * @api private\n */\n\nif ('undefined' != typeof navigator\n  && /iPad|iPhone|iPod/i.test(navigator.userAgent)) {\n  WS.prototype.onData = function(data){\n    var self = this;\n    setTimeout(function(){\n      Transport.prototype.onData.call(self, data);\n    }, 0);\n  };\n}\n\n/**\n * Writes data to socket.\n *\n * @param {Array} array of packets.\n * @api private\n */\n\nWS.prototype.write = function(packets){\n  var self = this;\n  this.writable = false;\n  // encodePacket efficient as it uses WS framing\n  // no need for encodePayload\n  for (var i = 0, l = packets.length; i < l; i++) {\n    parser.encodePacket(packets[i], this.supportsBinary, function(data) {\n      //Sometimes the websocket has already been closed but the browser didn't\n      //have a chance of informing us about it yet, in that case send will\n      //throw an error\n      try {\n        self.ws.send(data);\n      } catch (e){\n        debug('websocket closed before onclose event');\n      }\n    });\n  }\n\n  function ondrain() {\n    self.writable = true;\n    self.emit('drain');\n  }\n  // fake drain\n  // defer to next tick to allow Socket to clear writeBuffer\n  setTimeout(ondrain, 0);\n};\n\n/**\n * Called upon close\n *\n * @api private\n */\n\nWS.prototype.onClose = function(){\n  Transport.prototype.onClose.call(this);\n};\n\n/**\n * Closes socket.\n *\n * @api private\n */\n\nWS.prototype.doClose = function(){\n  if (typeof this.ws !== 'undefined') {\n    this.ws.close();\n  }\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nWS.prototype.uri = function(){\n  var query = this.query || {};\n  var schema = this.secure ? 'wss' : 'ws';\n  var port = '';\n\n  // avoid port if default for schema\n  if (this.port && (('wss' == schema && this.port != 443)\n    || ('ws' == schema && this.port != 80))) {\n    port = ':' + this.port;\n  }\n\n  // append timestamp to URI\n  if (this.timestampRequests) {\n    query[this.timestampParam] = +new Date;\n  }\n\n  // communicate binary support capabilities\n  if (!this.supportsBinary) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  return schema + '://' + this.hostname + port + this.path + query;\n};\n\n/**\n * Feature detection for WebSocket.\n *\n * @return {Boolean} whether this transport is available.\n * @api public\n */\n\nWS.prototype.check = function(){\n  return !!WebSocket && !('__initialize' in WebSocket && this.name === WS.prototype.name);\n};\n\n},{\"../transport\":16,\"component-inherit\":23,\"debug\":24,\"engine.io-parser\":27,\"parseqs\":39,\"ws\":41}],22:[function(_dereq_,module,exports){\n// browser shim for xmlhttprequest module\nvar hasCORS = _dereq_('has-cors');\n\nmodule.exports = function(opts) {\n  var xdomain = opts.xdomain;\n\n  // scheme must be same when usign XDomainRequest\n  // http://blogs.msdn.com/b/ieinternals/archive/2010/05/13/xdomainrequest-restrictions-limitations-and-workarounds.aspx\n  var xscheme = opts.xscheme;\n\n  // XDomainRequest has a flow of not sending cookie, therefore it should be disabled as a default.\n  // https://github.com/Automattic/engine.io-client/pull/217\n  var enablesXDR = opts.enablesXDR;\n\n  // XMLHttpRequest can be disabled on IE\n  try {\n    if ('undefined' != typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n      return new XMLHttpRequest();\n    }\n  } catch (e) { }\n\n  // Use XDomainRequest for IE8 if enablesXDR is true\n  // because loading bar keeps flashing when using jsonp-polling\n  // https://github.com/yujiosaka/socke.io-ie8-loading-example\n  try {\n    if ('undefined' != typeof XDomainRequest && !xscheme && enablesXDR) {\n      return new XDomainRequest();\n    }\n  } catch (e) { }\n\n  if (!xdomain) {\n    try {\n      return new ActiveXObject('Microsoft.XMLHTTP');\n    } catch(e) { }\n  }\n}\n\n},{\"has-cors\":36}],23:[function(_dereq_,module,exports){\n\nmodule.exports = function(a, b){\n  var fn = function(){};\n  fn.prototype = b.prototype;\n  a.prototype = new fn;\n  a.prototype.constructor = a;\n};\n},{}],24:[function(_dereq_,module,exports){\n\n/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = _dereq_('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  'lightseagreen',\n  'forestgreen',\n  'goldenrod',\n  'dodgerblue',\n  'darkorchid',\n  'crimson'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  return ('WebkitAppearance' in document.documentElement.style) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (window.console && (console.firebug || (console.exception && console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31);\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  return JSON.stringify(v);\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs() {\n  var args = arguments;\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return args;\n\n  var c = 'color: ' + this.color;\n  args = [args[0], c, 'color: inherit'].concat(Array.prototype.slice.call(args, 1));\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n  return args;\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // This hackery is required for IE8,\n  // where the `console.log` function doesn't have 'apply'\n  return 'object' == typeof console\n    && 'function' == typeof console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      localStorage.removeItem('debug');\n    } else {\n      localStorage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = localStorage.debug;\n  } catch(e) {}\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n},{\"./debug\":25}],25:[function(_dereq_,module,exports){\n\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = debug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = _dereq_('ms');\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lowercased letter, i.e. \"n\".\n */\n\nexports.formatters = {};\n\n/**\n * Previously assigned color.\n */\n\nvar prevColor = 0;\n\n/**\n * Previous log timestamp.\n */\n\nvar prevTime;\n\n/**\n * Select a color.\n *\n * @return {Number}\n * @api private\n */\n\nfunction selectColor() {\n  return exports.colors[prevColor++ % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction debug(namespace) {\n\n  // define the `disabled` version\n  function disabled() {\n  }\n  disabled.enabled = false;\n\n  // define the `enabled` version\n  function enabled() {\n\n    var self = enabled;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // add the `color` if not set\n    if (null == self.useColors) self.useColors = exports.useColors();\n    if (null == self.color && self.useColors) self.color = selectColor();\n\n    var args = Array.prototype.slice.call(arguments);\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %o\n      args = ['%o'].concat(args);\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    if ('function' === typeof exports.formatArgs) {\n      args = exports.formatArgs.apply(self, args);\n    }\n    var logFn = enabled.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n  enabled.enabled = true;\n\n  var fn = exports.enabled(namespace) ? enabled : disabled;\n\n  fn.namespace = namespace;\n\n  return fn;\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  var split = (namespaces || '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (var i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n\n},{\"ms\":26}],26:[function(_dereq_,module,exports){\n/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} options\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options){\n  options = options || {};\n  if ('string' == typeof val) return parse(val);\n  return options.long\n    ? long(val)\n    : short(val);\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  var match = /^((?:\\d+)?\\.?\\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);\n  if (!match) return;\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 's':\n      return n * s;\n    case 'ms':\n      return n;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction short(ms) {\n  if (ms >= d) return Math.round(ms / d) + 'd';\n  if (ms >= h) return Math.round(ms / h) + 'h';\n  if (ms >= m) return Math.round(ms / m) + 'm';\n  if (ms >= s) return Math.round(ms / s) + 's';\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction long(ms) {\n  return plural(ms, d, 'day')\n    || plural(ms, h, 'hour')\n    || plural(ms, m, 'minute')\n    || plural(ms, s, 'second')\n    || ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) return;\n  if (ms < n * 1.5) return Math.floor(ms / n) + ' ' + name;\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n\n},{}],27:[function(_dereq_,module,exports){\n(function (global){\n/**\n * Module dependencies.\n */\n\nvar keys = _dereq_('./keys');\nvar hasBinary = _dereq_('has-binary');\nvar sliceBuffer = _dereq_('arraybuffer.slice');\nvar base64encoder = _dereq_('base64-arraybuffer');\nvar after = _dereq_('after');\nvar utf8 = _dereq_('utf8');\n\n/**\n * Check if we are running an android browser. That requires us to use\n * ArrayBuffer with polling transports...\n *\n * http://ghinda.net/jpeg-blob-ajax-android/\n */\n\nvar isAndroid = navigator.userAgent.match(/Android/i);\n\n/**\n * Check if we are running in PhantomJS.\n * Uploading a Blob with PhantomJS does not work correctly, as reported here:\n * https://github.com/ariya/phantomjs/issues/11395\n * @type boolean\n */\nvar isPhantomJS = /PhantomJS/i.test(navigator.userAgent);\n\n/**\n * When true, avoids using Blobs to encode payloads.\n * @type boolean\n */\nvar dontSendBlobs = isAndroid || isPhantomJS;\n\n/**\n * Current protocol version.\n */\n\nexports.protocol = 3;\n\n/**\n * Packet types.\n */\n\nvar packets = exports.packets = {\n    open:     0    // non-ws\n  , close:    1    // non-ws\n  , ping:     2\n  , pong:     3\n  , message:  4\n  , upgrade:  5\n  , noop:     6\n};\n\nvar packetslist = keys(packets);\n\n/**\n * Premade error packet.\n */\n\nvar err = { type: 'error', data: 'parser error' };\n\n/**\n * Create a blob api even for blob builder when vendor prefixes exist\n */\n\nvar Blob = _dereq_('blob');\n\n/**\n * Encodes a packet.\n *\n *     <packet type id> [ <data> ]\n *\n * Example:\n *\n *     5hello world\n *     3\n *     4\n *\n * Binary is encoded in an identical principle\n *\n * @api private\n */\n\nexports.encodePacket = function (packet, supportsBinary, utf8encode, callback) {\n  if ('function' == typeof supportsBinary) {\n    callback = supportsBinary;\n    supportsBinary = false;\n  }\n\n  if ('function' == typeof utf8encode) {\n    callback = utf8encode;\n    utf8encode = null;\n  }\n\n  var data = (packet.data === undefined)\n    ? undefined\n    : packet.data.buffer || packet.data;\n\n  if (global.ArrayBuffer && data instanceof ArrayBuffer) {\n    return encodeArrayBuffer(packet, supportsBinary, callback);\n  } else if (Blob && data instanceof global.Blob) {\n    return encodeBlob(packet, supportsBinary, callback);\n  }\n\n  // might be an object with { base64: true, data: dataAsBase64String }\n  if (data && data.base64) {\n    return encodeBase64Object(packet, callback);\n  }\n\n  // Sending data as a utf-8 string\n  var encoded = packets[packet.type];\n\n  // data fragment is optional\n  if (undefined !== packet.data) {\n    encoded += utf8encode ? utf8.encode(String(packet.data)) : String(packet.data);\n  }\n\n  return callback('' + encoded);\n\n};\n\nfunction encodeBase64Object(packet, callback) {\n  // packet data is an object { base64: true, data: dataAsBase64String }\n  var message = 'b' + exports.packets[packet.type] + packet.data.data;\n  return callback(message);\n}\n\n/**\n * Encode packet helpers for binary types\n */\n\nfunction encodeArrayBuffer(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  var data = packet.data;\n  var contentArray = new Uint8Array(data);\n  var resultBuffer = new Uint8Array(1 + data.byteLength);\n\n  resultBuffer[0] = packets[packet.type];\n  for (var i = 0; i < contentArray.length; i++) {\n    resultBuffer[i+1] = contentArray[i];\n  }\n\n  return callback(resultBuffer.buffer);\n}\n\nfunction encodeBlobAsArrayBuffer(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  var fr = new FileReader();\n  fr.onload = function() {\n    packet.data = fr.result;\n    exports.encodePacket(packet, supportsBinary, true, callback);\n  };\n  return fr.readAsArrayBuffer(packet.data);\n}\n\nfunction encodeBlob(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  if (dontSendBlobs) {\n    return encodeBlobAsArrayBuffer(packet, supportsBinary, callback);\n  }\n\n  var length = new Uint8Array(1);\n  length[0] = packets[packet.type];\n  var blob = new Blob([length.buffer, packet.data]);\n\n  return callback(blob);\n}\n\n/**\n * Encodes a packet with binary data in a base64 string\n *\n * @param {Object} packet, has `type` and `data`\n * @return {String} base64 encoded message\n */\n\nexports.encodeBase64Packet = function(packet, callback) {\n  var message = 'b' + exports.packets[packet.type];\n  if (Blob && packet.data instanceof Blob) {\n    var fr = new FileReader();\n    fr.onload = function() {\n      var b64 = fr.result.split(',')[1];\n      callback(message + b64);\n    };\n    return fr.readAsDataURL(packet.data);\n  }\n\n  var b64data;\n  try {\n    b64data = String.fromCharCode.apply(null, new Uint8Array(packet.data));\n  } catch (e) {\n    // iPhone Safari doesn't let you apply with typed arrays\n    var typed = new Uint8Array(packet.data);\n    var basic = new Array(typed.length);\n    for (var i = 0; i < typed.length; i++) {\n      basic[i] = typed[i];\n    }\n    b64data = String.fromCharCode.apply(null, basic);\n  }\n  message += global.btoa(b64data);\n  return callback(message);\n};\n\n/**\n * Decodes a packet. Changes format to Blob if requested.\n *\n * @return {Object} with `type` and `data` (if any)\n * @api private\n */\n\nexports.decodePacket = function (data, binaryType, utf8decode) {\n  // String data\n  if (typeof data == 'string' || data === undefined) {\n    if (data.charAt(0) == 'b') {\n      return exports.decodeBase64Packet(data.substr(1), binaryType);\n    }\n\n    if (utf8decode) {\n      try {\n        data = utf8.decode(data);\n      } catch (e) {\n        return err;\n      }\n    }\n    var type = data.charAt(0);\n\n    if (Number(type) != type || !packetslist[type]) {\n      return err;\n    }\n\n    if (data.length > 1) {\n      return { type: packetslist[type], data: data.substring(1) };\n    } else {\n      return { type: packetslist[type] };\n    }\n  }\n\n  var asArray = new Uint8Array(data);\n  var type = asArray[0];\n  var rest = sliceBuffer(data, 1);\n  if (Blob && binaryType === 'blob') {\n    rest = new Blob([rest]);\n  }\n  return { type: packetslist[type], data: rest };\n};\n\n/**\n * Decodes a packet encoded in a base64 string\n *\n * @param {String} base64 encoded message\n * @return {Object} with `type` and `data` (if any)\n */\n\nexports.decodeBase64Packet = function(msg, binaryType) {\n  var type = packetslist[msg.charAt(0)];\n  if (!global.ArrayBuffer) {\n    return { type: type, data: { base64: true, data: msg.substr(1) } };\n  }\n\n  var data = base64encoder.decode(msg.substr(1));\n\n  if (binaryType === 'blob' && Blob) {\n    data = new Blob([data]);\n  }\n\n  return { type: type, data: data };\n};\n\n/**\n * Encodes multiple messages (payload).\n *\n *     <length>:data\n *\n * Example:\n *\n *     11:hello world2:hi\n *\n * If any contents are binary, they will be encoded as base64 strings. Base64\n * encoded strings are marked with a b before the length specifier\n *\n * @param {Array} packets\n * @api private\n */\n\nexports.encodePayload = function (packets, supportsBinary, callback) {\n  if (typeof supportsBinary == 'function') {\n    callback = supportsBinary;\n    supportsBinary = null;\n  }\n\n  var isBinary = hasBinary(packets);\n\n  if (supportsBinary && isBinary) {\n    if (Blob && !dontSendBlobs) {\n      return exports.encodePayloadAsBlob(packets, callback);\n    }\n\n    return exports.encodePayloadAsArrayBuffer(packets, callback);\n  }\n\n  if (!packets.length) {\n    return callback('0:');\n  }\n\n  function setLengthHeader(message) {\n    return message.length + ':' + message;\n  }\n\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, !isBinary ? false : supportsBinary, true, function(message) {\n      doneCallback(null, setLengthHeader(message));\n    });\n  }\n\n  map(packets, encodeOne, function(err, results) {\n    return callback(results.join(''));\n  });\n};\n\n/**\n * Async array map using after\n */\n\nfunction map(ary, each, done) {\n  var result = new Array(ary.length);\n  var next = after(ary.length, done);\n\n  var eachWithIndex = function(i, el, cb) {\n    each(el, function(error, msg) {\n      result[i] = msg;\n      cb(error, result);\n    });\n  };\n\n  for (var i = 0; i < ary.length; i++) {\n    eachWithIndex(i, ary[i], next);\n  }\n}\n\n/*\n * Decodes data when a payload is maybe expected. Possible binary contents are\n * decoded from their base64 representation\n *\n * @param {String} data, callback method\n * @api public\n */\n\nexports.decodePayload = function (data, binaryType, callback) {\n  if (typeof data != 'string') {\n    return exports.decodePayloadAsBinary(data, binaryType, callback);\n  }\n\n  if (typeof binaryType === 'function') {\n    callback = binaryType;\n    binaryType = null;\n  }\n\n  var packet;\n  if (data == '') {\n    // parser error - ignoring payload\n    return callback(err, 0, 1);\n  }\n\n  var length = ''\n    , n, msg;\n\n  for (var i = 0, l = data.length; i < l; i++) {\n    var chr = data.charAt(i);\n\n    if (':' != chr) {\n      length += chr;\n    } else {\n      if ('' == length || (length != (n = Number(length)))) {\n        // parser error - ignoring payload\n        return callback(err, 0, 1);\n      }\n\n      msg = data.substr(i + 1, n);\n\n      if (length != msg.length) {\n        // parser error - ignoring payload\n        return callback(err, 0, 1);\n      }\n\n      if (msg.length) {\n        packet = exports.decodePacket(msg, binaryType, true);\n\n        if (err.type == packet.type && err.data == packet.data) {\n          // parser error in individual packet - ignoring payload\n          return callback(err, 0, 1);\n        }\n\n        var ret = callback(packet, i + n, l);\n        if (false === ret) return;\n      }\n\n      // advance cursor\n      i += n;\n      length = '';\n    }\n  }\n\n  if (length != '') {\n    // parser error - ignoring payload\n    return callback(err, 0, 1);\n  }\n\n};\n\n/**\n * Encodes multiple messages (payload) as binary.\n *\n * <1 = binary, 0 = string><number from 0-9><number from 0-9>[...]<number\n * 255><data>\n *\n * Example:\n * 1 3 255 1 2 3, if the binary contents are interpreted as 8 bit integers\n *\n * @param {Array} packets\n * @return {ArrayBuffer} encoded payload\n * @api private\n */\n\nexports.encodePayloadAsArrayBuffer = function(packets, callback) {\n  if (!packets.length) {\n    return callback(new ArrayBuffer(0));\n  }\n\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, true, true, function(data) {\n      return doneCallback(null, data);\n    });\n  }\n\n  map(packets, encodeOne, function(err, encodedPackets) {\n    var totalLength = encodedPackets.reduce(function(acc, p) {\n      var len;\n      if (typeof p === 'string'){\n        len = p.length;\n      } else {\n        len = p.byteLength;\n      }\n      return acc + len.toString().length + len + 2; // string/binary identifier + separator = 2\n    }, 0);\n\n    var resultArray = new Uint8Array(totalLength);\n\n    var bufferIndex = 0;\n    encodedPackets.forEach(function(p) {\n      var isString = typeof p === 'string';\n      var ab = p;\n      if (isString) {\n        var view = new Uint8Array(p.length);\n        for (var i = 0; i < p.length; i++) {\n          view[i] = p.charCodeAt(i);\n        }\n        ab = view.buffer;\n      }\n\n      if (isString) { // not true binary\n        resultArray[bufferIndex++] = 0;\n      } else { // true binary\n        resultArray[bufferIndex++] = 1;\n      }\n\n      var lenStr = ab.byteLength.toString();\n      for (var i = 0; i < lenStr.length; i++) {\n        resultArray[bufferIndex++] = parseInt(lenStr[i]);\n      }\n      resultArray[bufferIndex++] = 255;\n\n      var view = new Uint8Array(ab);\n      for (var i = 0; i < view.length; i++) {\n        resultArray[bufferIndex++] = view[i];\n      }\n    });\n\n    return callback(resultArray.buffer);\n  });\n};\n\n/**\n * Encode as Blob\n */\n\nexports.encodePayloadAsBlob = function(packets, callback) {\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, true, true, function(encoded) {\n      var binaryIdentifier = new Uint8Array(1);\n      binaryIdentifier[0] = 1;\n      if (typeof encoded === 'string') {\n        var view = new Uint8Array(encoded.length);\n        for (var i = 0; i < encoded.length; i++) {\n          view[i] = encoded.charCodeAt(i);\n        }\n        encoded = view.buffer;\n        binaryIdentifier[0] = 0;\n      }\n\n      var len = (encoded instanceof ArrayBuffer)\n        ? encoded.byteLength\n        : encoded.size;\n\n      var lenStr = len.toString();\n      var lengthAry = new Uint8Array(lenStr.length + 1);\n      for (var i = 0; i < lenStr.length; i++) {\n        lengthAry[i] = parseInt(lenStr[i]);\n      }\n      lengthAry[lenStr.length] = 255;\n\n      if (Blob) {\n        var blob = new Blob([binaryIdentifier.buffer, lengthAry.buffer, encoded]);\n        doneCallback(null, blob);\n      }\n    });\n  }\n\n  map(packets, encodeOne, function(err, results) {\n    return callback(new Blob(results));\n  });\n};\n\n/*\n * Decodes data when a payload is maybe expected. Strings are decoded by\n * interpreting each byte as a key code for entries marked to start with 0. See\n * description of encodePayloadAsBinary\n *\n * @param {ArrayBuffer} data, callback method\n * @api public\n */\n\nexports.decodePayloadAsBinary = function (data, binaryType, callback) {\n  if (typeof binaryType === 'function') {\n    callback = binaryType;\n    binaryType = null;\n  }\n\n  var bufferTail = data;\n  var buffers = [];\n\n  var numberTooLong = false;\n  while (bufferTail.byteLength > 0) {\n    var tailArray = new Uint8Array(bufferTail);\n    var isString = tailArray[0] === 0;\n    var msgLength = '';\n\n    for (var i = 1; ; i++) {\n      if (tailArray[i] == 255) break;\n\n      if (msgLength.length > 310) {\n        numberTooLong = true;\n        break;\n      }\n\n      msgLength += tailArray[i];\n    }\n\n    if(numberTooLong) return callback(err, 0, 1);\n\n    bufferTail = sliceBuffer(bufferTail, 2 + msgLength.length);\n    msgLength = parseInt(msgLength);\n\n    var msg = sliceBuffer(bufferTail, 0, msgLength);\n    if (isString) {\n      try {\n        msg = String.fromCharCode.apply(null, new Uint8Array(msg));\n      } catch (e) {\n        // iPhone Safari doesn't let you apply to typed arrays\n        var typed = new Uint8Array(msg);\n        msg = '';\n        for (var i = 0; i < typed.length; i++) {\n          msg += String.fromCharCode(typed[i]);\n        }\n      }\n    }\n\n    buffers.push(msg);\n    bufferTail = sliceBuffer(bufferTail, msgLength);\n  }\n\n  var total = buffers.length;\n  buffers.forEach(function(buffer, i) {\n    callback(exports.decodePacket(buffer, binaryType, true), i, total);\n  });\n};\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./keys\":28,\"after\":29,\"arraybuffer.slice\":30,\"base64-arraybuffer\":31,\"blob\":32,\"has-binary\":33,\"utf8\":35}],28:[function(_dereq_,module,exports){\n\n/**\n * Gets the keys for an object.\n *\n * @return {Array} keys\n * @api private\n */\n\nmodule.exports = Object.keys || function keys (obj){\n  var arr = [];\n  var has = Object.prototype.hasOwnProperty;\n\n  for (var i in obj) {\n    if (has.call(obj, i)) {\n      arr.push(i);\n    }\n  }\n  return arr;\n};\n\n},{}],29:[function(_dereq_,module,exports){\nmodule.exports = after\n\nfunction after(count, callback, err_cb) {\n    var bail = false\n    err_cb = err_cb || noop\n    proxy.count = count\n\n    return (count === 0) ? callback() : proxy\n\n    function proxy(err, result) {\n        if (proxy.count <= 0) {\n            throw new Error('after called too many times')\n        }\n        --proxy.count\n\n        // after first error, rest are passed to err_cb\n        if (err) {\n            bail = true\n            callback(err)\n            // future error callbacks will go to error handler\n            callback = err_cb\n        } else if (proxy.count === 0 && !bail) {\n            callback(null, result)\n        }\n    }\n}\n\nfunction noop() {}\n\n},{}],30:[function(_dereq_,module,exports){\n/**\n * An abstraction for slicing an arraybuffer even when\n * ArrayBuffer.prototype.slice is not supported\n *\n * @api public\n */\n\nmodule.exports = function(arraybuffer, start, end) {\n  var bytes = arraybuffer.byteLength;\n  start = start || 0;\n  end = end || bytes;\n\n  if (arraybuffer.slice) { return arraybuffer.slice(start, end); }\n\n  if (start < 0) { start += bytes; }\n  if (end < 0) { end += bytes; }\n  if (end > bytes) { end = bytes; }\n\n  if (start >= bytes || start >= end || bytes === 0) {\n    return new ArrayBuffer(0);\n  }\n\n  var abv = new Uint8Array(arraybuffer);\n  var result = new Uint8Array(end - start);\n  for (var i = start, ii = 0; i < end; i++, ii++) {\n    result[ii] = abv[i];\n  }\n  return result.buffer;\n};\n\n},{}],31:[function(_dereq_,module,exports){\n/*\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n(function(chars){\n  \"use strict\";\n\n  exports.encode = function(arraybuffer) {\n    var bytes = new Uint8Array(arraybuffer),\n    i, len = bytes.length, base64 = \"\";\n\n    for (i = 0; i < len; i+=3) {\n      base64 += chars[bytes[i] >> 2];\n      base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n      base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n      base64 += chars[bytes[i + 2] & 63];\n    }\n\n    if ((len % 3) === 2) {\n      base64 = base64.substring(0, base64.length - 1) + \"=\";\n    } else if (len % 3 === 1) {\n      base64 = base64.substring(0, base64.length - 2) + \"==\";\n    }\n\n    return base64;\n  };\n\n  exports.decode =  function(base64) {\n    var bufferLength = base64.length * 0.75,\n    len = base64.length, i, p = 0,\n    encoded1, encoded2, encoded3, encoded4;\n\n    if (base64[base64.length - 1] === \"=\") {\n      bufferLength--;\n      if (base64[base64.length - 2] === \"=\") {\n        bufferLength--;\n      }\n    }\n\n    var arraybuffer = new ArrayBuffer(bufferLength),\n    bytes = new Uint8Array(arraybuffer);\n\n    for (i = 0; i < len; i+=4) {\n      encoded1 = chars.indexOf(base64[i]);\n      encoded2 = chars.indexOf(base64[i+1]);\n      encoded3 = chars.indexOf(base64[i+2]);\n      encoded4 = chars.indexOf(base64[i+3]);\n\n      bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n      bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n      bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n\n    return arraybuffer;\n  };\n})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\");\n\n},{}],32:[function(_dereq_,module,exports){\n(function (global){\n/**\n * Create a blob builder even when vendor prefixes exist\n */\n\nvar BlobBuilder = global.BlobBuilder\n  || global.WebKitBlobBuilder\n  || global.MSBlobBuilder\n  || global.MozBlobBuilder;\n\n/**\n * Check if Blob constructor is supported\n */\n\nvar blobSupported = (function() {\n  try {\n    var b = new Blob(['hi']);\n    return b.size == 2;\n  } catch(e) {\n    return false;\n  }\n})();\n\n/**\n * Check if BlobBuilder is supported\n */\n\nvar blobBuilderSupported = BlobBuilder\n  && BlobBuilder.prototype.append\n  && BlobBuilder.prototype.getBlob;\n\nfunction BlobBuilderConstructor(ary, options) {\n  options = options || {};\n\n  var bb = new BlobBuilder();\n  for (var i = 0; i < ary.length; i++) {\n    bb.append(ary[i]);\n  }\n  return (options.type) ? bb.getBlob(options.type) : bb.getBlob();\n};\n\nmodule.exports = (function() {\n  if (blobSupported) {\n    return global.Blob;\n  } else if (blobBuilderSupported) {\n    return BlobBuilderConstructor;\n  } else {\n    return undefined;\n  }\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],33:[function(_dereq_,module,exports){\n(function (global){\n\n/*\n * Module requirements.\n */\n\nvar isArray = _dereq_('isarray');\n\n/**\n * Module exports.\n */\n\nmodule.exports = hasBinary;\n\n/**\n * Checks for binary data.\n *\n * Right now only Buffer and ArrayBuffer are supported..\n *\n * @param {Object} anything\n * @api public\n */\n\nfunction hasBinary(data) {\n\n  function _hasBinary(obj) {\n    if (!obj) return false;\n\n    if ( (global.Buffer && global.Buffer.isBuffer(obj)) ||\n         (global.ArrayBuffer && obj instanceof ArrayBuffer) ||\n         (global.Blob && obj instanceof Blob) ||\n         (global.File && obj instanceof File)\n        ) {\n      return true;\n    }\n\n    if (isArray(obj)) {\n      for (var i = 0; i < obj.length; i++) {\n          if (_hasBinary(obj[i])) {\n              return true;\n          }\n      }\n    } else if (obj && 'object' == typeof obj) {\n      if (obj.toJSON) {\n        obj = obj.toJSON();\n      }\n\n      for (var key in obj) {\n        if (obj.hasOwnProperty(key) && _hasBinary(obj[key])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  return _hasBinary(data);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"isarray\":34}],34:[function(_dereq_,module,exports){\nmodule.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n\n},{}],35:[function(_dereq_,module,exports){\n(function (global){\n/*! http://mths.be/utf8js v2.0.0 by @mathias */\n;(function(root) {\n\n\t// Detect free variables `exports`\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code,\n\t// and use it as `root`\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar stringFromCharCode = String.fromCharCode;\n\n\t// Taken from http://mths.be/punycode\n\tfunction ucs2decode(string) {\n\t\tvar output = [];\n\t\tvar counter = 0;\n\t\tvar length = string.length;\n\t\tvar value;\n\t\tvar extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t// Taken from http://mths.be/punycode\n\tfunction ucs2encode(array) {\n\t\tvar length = array.length;\n\t\tvar index = -1;\n\t\tvar value;\n\t\tvar output = '';\n\t\twhile (++index < length) {\n\t\t\tvalue = array[index];\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t}\n\t\treturn output;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction createByte(codePoint, shift) {\n\t\treturn stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);\n\t}\n\n\tfunction encodeCodePoint(codePoint) {\n\t\tif ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence\n\t\t\treturn stringFromCharCode(codePoint);\n\t\t}\n\t\tvar symbol = '';\n\t\tif ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);\n\t\t}\n\t\telse if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\telse if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);\n\t\t\tsymbol += createByte(codePoint, 12);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\tsymbol += stringFromCharCode((codePoint & 0x3F) | 0x80);\n\t\treturn symbol;\n\t}\n\n\tfunction utf8encode(string) {\n\t\tvar codePoints = ucs2decode(string);\n\n\t\t// console.log(JSON.stringify(codePoints.map(function(x) {\n\t\t// \treturn 'U+' + x.toString(16).toUpperCase();\n\t\t// })));\n\n\t\tvar length = codePoints.length;\n\t\tvar index = -1;\n\t\tvar codePoint;\n\t\tvar byteString = '';\n\t\twhile (++index < length) {\n\t\t\tcodePoint = codePoints[index];\n\t\t\tbyteString += encodeCodePoint(codePoint);\n\t\t}\n\t\treturn byteString;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction readContinuationByte() {\n\t\tif (byteIndex >= byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tvar continuationByte = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\tif ((continuationByte & 0xC0) == 0x80) {\n\t\t\treturn continuationByte & 0x3F;\n\t\t}\n\n\t\t// If we end up here, it’s not a continuation byte\n\t\tthrow Error('Invalid continuation byte');\n\t}\n\n\tfunction decodeSymbol() {\n\t\tvar byte1;\n\t\tvar byte2;\n\t\tvar byte3;\n\t\tvar byte4;\n\t\tvar codePoint;\n\n\t\tif (byteIndex > byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tif (byteIndex == byteCount) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Read first byte\n\t\tbyte1 = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\t// 1-byte sequence (no continuation bytes)\n\t\tif ((byte1 & 0x80) == 0) {\n\t\t\treturn byte1;\n\t\t}\n\n\t\t// 2-byte sequence\n\t\tif ((byte1 & 0xE0) == 0xC0) {\n\t\t\tvar byte2 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x1F) << 6) | byte2;\n\t\t\tif (codePoint >= 0x80) {\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 3-byte sequence (may include unpaired surrogates)\n\t\tif ((byte1 & 0xF0) == 0xE0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;\n\t\t\tif (codePoint >= 0x0800) {\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 4-byte sequence\n\t\tif ((byte1 & 0xF8) == 0xF0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tbyte4 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 0x12) | (byte2 << 0x0C) |\n\t\t\t\t(byte3 << 0x06) | byte4;\n\t\t\tif (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\t\treturn codePoint;\n\t\t\t}\n\t\t}\n\n\t\tthrow Error('Invalid UTF-8 detected');\n\t}\n\n\tvar byteArray;\n\tvar byteCount;\n\tvar byteIndex;\n\tfunction utf8decode(byteString) {\n\t\tbyteArray = ucs2decode(byteString);\n\t\tbyteCount = byteArray.length;\n\t\tbyteIndex = 0;\n\t\tvar codePoints = [];\n\t\tvar tmp;\n\t\twhile ((tmp = decodeSymbol()) !== false) {\n\t\t\tcodePoints.push(tmp);\n\t\t}\n\t\treturn ucs2encode(codePoints);\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar utf8 = {\n\t\t'version': '2.0.0',\n\t\t'encode': utf8encode,\n\t\t'decode': utf8decode\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn utf8;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = utf8;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tvar object = {};\n\t\t\tvar hasOwnProperty = object.hasOwnProperty;\n\t\t\tfor (var key in utf8) {\n\t\t\t\thasOwnProperty.call(utf8, key) && (freeExports[key] = utf8[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.utf8 = utf8;\n\t}\n\n}(this));\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],36:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar global = _dereq_('global');\n\n/**\n * Module exports.\n *\n * Logic borrowed from Modernizr:\n *\n *   - https://github.com/Modernizr/Modernizr/blob/master/feature-detects/cors.js\n */\n\ntry {\n  module.exports = 'XMLHttpRequest' in global &&\n    'withCredentials' in new global.XMLHttpRequest();\n} catch (err) {\n  // if XMLHttp support is disabled in IE then it will throw\n  // when trying to create\n  module.exports = false;\n}\n\n},{\"global\":37}],37:[function(_dereq_,module,exports){\n\n/**\n * Returns `this`. Execute this without a \"context\" (i.e. without it being\n * attached to an object of the left-hand side), and `this` points to the\n * \"global\" scope of the current JS execution.\n */\n\nmodule.exports = (function () { return this; })();\n\n},{}],38:[function(_dereq_,module,exports){\n(function (global){\n/**\n * JSON parse.\n *\n * @see Based on jQuery#parseJSON (MIT) and JSON2\n * @api private\n */\n\nvar rvalidchars = /^[\\],:{}\\s]*$/;\nvar rvalidescape = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\nvar rvalidtokens = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\nvar rvalidbraces = /(?:^|:|,)(?:\\s*\\[)+/g;\nvar rtrimLeft = /^\\s+/;\nvar rtrimRight = /\\s+$/;\n\nmodule.exports = function parsejson(data) {\n  if ('string' != typeof data || !data) {\n    return null;\n  }\n\n  data = data.replace(rtrimLeft, '').replace(rtrimRight, '');\n\n  // Attempt to parse using the native JSON parser first\n  if (global.JSON && JSON.parse) {\n    return JSON.parse(data);\n  }\n\n  if (rvalidchars.test(data.replace(rvalidescape, '@')\n      .replace(rvalidtokens, ']')\n      .replace(rvalidbraces, ''))) {\n    return (new Function('return ' + data))();\n  }\n};\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],39:[function(_dereq_,module,exports){\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\n\nexports.encode = function (obj) {\n  var str = '';\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (str.length) str += '&';\n      str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n    }\n  }\n\n  return str;\n};\n\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\n\nexports.decode = function(qs){\n  var qry = {};\n  var pairs = qs.split('&');\n  for (var i = 0, l = pairs.length; i < l; i++) {\n    var pair = pairs[i].split('=');\n    qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n  }\n  return qry;\n};\n\n},{}],40:[function(_dereq_,module,exports){\n/**\n * Parses an URI\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\n\nvar re = /^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nvar parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\n\nmodule.exports = function parseuri(str) {\n    var src = str,\n        b = str.indexOf('['),\n        e = str.indexOf(']');\n\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n\n    var m = re.exec(str || ''),\n        uri = {},\n        i = 14;\n\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n\n    return uri;\n};\n\n},{}],41:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n\n},{}],42:[function(_dereq_,module,exports){\n(function (global){\n\n/*\n * Module requirements.\n */\n\nvar isArray = _dereq_('isarray');\n\n/**\n * Module exports.\n */\n\nmodule.exports = hasBinary;\n\n/**\n * Checks for binary data.\n *\n * Right now only Buffer and ArrayBuffer are supported..\n *\n * @param {Object} anything\n * @api public\n */\n\nfunction hasBinary(data) {\n\n  function _hasBinary(obj) {\n    if (!obj) return false;\n\n    if ( (global.Buffer && global.Buffer.isBuffer(obj)) ||\n         (global.ArrayBuffer && obj instanceof ArrayBuffer) ||\n         (global.Blob && obj instanceof Blob) ||\n         (global.File && obj instanceof File)\n        ) {\n      return true;\n    }\n\n    if (isArray(obj)) {\n      for (var i = 0; i < obj.length; i++) {\n          if (_hasBinary(obj[i])) {\n              return true;\n          }\n      }\n    } else if (obj && 'object' == typeof obj) {\n      if (obj.toJSON) {\n        obj = obj.toJSON();\n      }\n\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && _hasBinary(obj[key])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  return _hasBinary(data);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"isarray\":43}],43:[function(_dereq_,module,exports){\narguments[4][34][0].apply(exports,arguments)\n},{\"dup\":34}],44:[function(_dereq_,module,exports){\n\nvar indexOf = [].indexOf;\n\nmodule.exports = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};\n},{}],45:[function(_dereq_,module,exports){\n\n/**\n * HOP ref.\n */\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Return own keys in `obj`.\n *\n * @param {Object} obj\n * @return {Array}\n * @api public\n */\n\nexports.keys = Object.keys || function(obj){\n  var keys = [];\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      keys.push(key);\n    }\n  }\n  return keys;\n};\n\n/**\n * Return own values in `obj`.\n *\n * @param {Object} obj\n * @return {Array}\n * @api public\n */\n\nexports.values = function(obj){\n  var vals = [];\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      vals.push(obj[key]);\n    }\n  }\n  return vals;\n};\n\n/**\n * Merge `b` into `a`.\n *\n * @param {Object} a\n * @param {Object} b\n * @return {Object} a\n * @api public\n */\n\nexports.merge = function(a, b){\n  for (var key in b) {\n    if (has.call(b, key)) {\n      a[key] = b[key];\n    }\n  }\n  return a;\n};\n\n/**\n * Return length of `obj`.\n *\n * @param {Object} obj\n * @return {Number}\n * @api public\n */\n\nexports.length = function(obj){\n  return exports.keys(obj).length;\n};\n\n/**\n * Check if `obj` is empty.\n *\n * @param {Object} obj\n * @return {Boolean}\n * @api public\n */\n\nexports.isEmpty = function(obj){\n  return 0 == exports.length(obj);\n};\n},{}],46:[function(_dereq_,module,exports){\n/**\n * Parses an URI\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\n\nvar re = /^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nvar parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host'\n  , 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\n\nmodule.exports = function parseuri(str) {\n  var m = re.exec(str || '')\n    , uri = {}\n    , i = 14;\n\n  while (i--) {\n    uri[parts[i]] = m[i] || '';\n  }\n\n  return uri;\n};\n\n},{}],47:[function(_dereq_,module,exports){\n(function (global){\n/*global Blob,File*/\n\n/**\n * Module requirements\n */\n\nvar isArray = _dereq_('isarray');\nvar isBuf = _dereq_('./is-buffer');\n\n/**\n * Replaces every Buffer | ArrayBuffer in packet with a numbered placeholder.\n * Anything with blobs or files should be fed through removeBlobs before coming\n * here.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @api public\n */\n\nexports.deconstructPacket = function(packet){\n  var buffers = [];\n  var packetData = packet.data;\n\n  function _deconstructPacket(data) {\n    if (!data) return data;\n\n    if (isBuf(data)) {\n      var placeholder = { _placeholder: true, num: buffers.length };\n      buffers.push(data);\n      return placeholder;\n    } else if (isArray(data)) {\n      var newData = new Array(data.length);\n      for (var i = 0; i < data.length; i++) {\n        newData[i] = _deconstructPacket(data[i]);\n      }\n      return newData;\n    } else if ('object' == typeof data && !(data instanceof Date)) {\n      var newData = {};\n      for (var key in data) {\n        newData[key] = _deconstructPacket(data[key]);\n      }\n      return newData;\n    }\n    return data;\n  }\n\n  var pack = packet;\n  pack.data = _deconstructPacket(packetData);\n  pack.attachments = buffers.length; // number of binary 'attachments'\n  return {packet: pack, buffers: buffers};\n};\n\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @api public\n */\n\nexports.reconstructPacket = function(packet, buffers) {\n  var curPlaceHolder = 0;\n\n  function _reconstructPacket(data) {\n    if (data && data._placeholder) {\n      var buf = buffers[data.num]; // appropriate buffer (should be natural order anyway)\n      return buf;\n    } else if (isArray(data)) {\n      for (var i = 0; i < data.length; i++) {\n        data[i] = _reconstructPacket(data[i]);\n      }\n      return data;\n    } else if (data && 'object' == typeof data) {\n      for (var key in data) {\n        data[key] = _reconstructPacket(data[key]);\n      }\n      return data;\n    }\n    return data;\n  }\n\n  packet.data = _reconstructPacket(packet.data);\n  packet.attachments = undefined; // no longer useful\n  return packet;\n};\n\n/**\n * Asynchronously removes Blobs or Files from data via\n * FileReader's readAsArrayBuffer method. Used before encoding\n * data as msgpack. Calls callback with the blobless data.\n *\n * @param {Object} data\n * @param {Function} callback\n * @api private\n */\n\nexports.removeBlobs = function(data, callback) {\n  function _removeBlobs(obj, curKey, containingObject) {\n    if (!obj) return obj;\n\n    // convert any blob\n    if ((global.Blob && obj instanceof Blob) ||\n        (global.File && obj instanceof File)) {\n      pendingBlobs++;\n\n      // async filereader\n      var fileReader = new FileReader();\n      fileReader.onload = function() { // this.result == arraybuffer\n        if (containingObject) {\n          containingObject[curKey] = this.result;\n        }\n        else {\n          bloblessData = this.result;\n        }\n\n        // if nothing pending its callback time\n        if(! --pendingBlobs) {\n          callback(bloblessData);\n        }\n      };\n\n      fileReader.readAsArrayBuffer(obj); // blob -> arraybuffer\n    } else if (isArray(obj)) { // handle array\n      for (var i = 0; i < obj.length; i++) {\n        _removeBlobs(obj[i], i, obj);\n      }\n    } else if (obj && 'object' == typeof obj && !isBuf(obj)) { // and object\n      for (var key in obj) {\n        _removeBlobs(obj[key], key, obj);\n      }\n    }\n  }\n\n  var pendingBlobs = 0;\n  var bloblessData = data;\n  _removeBlobs(bloblessData);\n  if (!pendingBlobs) {\n    callback(bloblessData);\n  }\n};\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./is-buffer\":49,\"isarray\":50}],48:[function(_dereq_,module,exports){\n\n/**\n * Module dependencies.\n */\n\nvar debug = _dereq_('debug')('socket.io-parser');\nvar json = _dereq_('json3');\nvar isArray = _dereq_('isarray');\nvar Emitter = _dereq_('component-emitter');\nvar binary = _dereq_('./binary');\nvar isBuf = _dereq_('./is-buffer');\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nexports.protocol = 4;\n\n/**\n * Packet types.\n *\n * @api public\n */\n\nexports.types = [\n  'CONNECT',\n  'DISCONNECT',\n  'EVENT',\n  'BINARY_EVENT',\n  'ACK',\n  'BINARY_ACK',\n  'ERROR'\n];\n\n/**\n * Packet type `connect`.\n *\n * @api public\n */\n\nexports.CONNECT = 0;\n\n/**\n * Packet type `disconnect`.\n *\n * @api public\n */\n\nexports.DISCONNECT = 1;\n\n/**\n * Packet type `event`.\n *\n * @api public\n */\n\nexports.EVENT = 2;\n\n/**\n * Packet type `ack`.\n *\n * @api public\n */\n\nexports.ACK = 3;\n\n/**\n * Packet type `error`.\n *\n * @api public\n */\n\nexports.ERROR = 4;\n\n/**\n * Packet type 'binary event'\n *\n * @api public\n */\n\nexports.BINARY_EVENT = 5;\n\n/**\n * Packet type `binary ack`. For acks with binary arguments.\n *\n * @api public\n */\n\nexports.BINARY_ACK = 6;\n\n/**\n * Encoder constructor.\n *\n * @api public\n */\n\nexports.Encoder = Encoder;\n\n/**\n * Decoder constructor.\n *\n * @api public\n */\n\nexports.Decoder = Decoder;\n\n/**\n * A socket.io Encoder instance\n *\n * @api public\n */\n\nfunction Encoder() {}\n\n/**\n * Encode a packet as a single string if non-binary, or as a\n * buffer sequence, depending on packet type.\n *\n * @param {Object} obj - packet object\n * @param {Function} callback - function to handle encodings (likely engine.write)\n * @return Calls callback with Array of encodings\n * @api public\n */\n\nEncoder.prototype.encode = function(obj, callback){\n  debug('encoding packet %j', obj);\n\n  if (exports.BINARY_EVENT == obj.type || exports.BINARY_ACK == obj.type) {\n    encodeAsBinary(obj, callback);\n  }\n  else {\n    var encoding = encodeAsString(obj);\n    callback([encoding]);\n  }\n};\n\n/**\n * Encode packet as string.\n *\n * @param {Object} packet\n * @return {String} encoded\n * @api private\n */\n\nfunction encodeAsString(obj) {\n  var str = '';\n  var nsp = false;\n\n  // first is type\n  str += obj.type;\n\n  // attachments if we have them\n  if (exports.BINARY_EVENT == obj.type || exports.BINARY_ACK == obj.type) {\n    str += obj.attachments;\n    str += '-';\n  }\n\n  // if we have a namespace other than `/`\n  // we append it followed by a comma `,`\n  if (obj.nsp && '/' != obj.nsp) {\n    nsp = true;\n    str += obj.nsp;\n  }\n\n  // immediately followed by the id\n  if (null != obj.id) {\n    if (nsp) {\n      str += ',';\n      nsp = false;\n    }\n    str += obj.id;\n  }\n\n  // json data\n  if (null != obj.data) {\n    if (nsp) str += ',';\n    str += json.stringify(obj.data);\n  }\n\n  debug('encoded %j as %s', obj, str);\n  return str;\n}\n\n/**\n * Encode packet as 'buffer sequence' by removing blobs, and\n * deconstructing packet into object with placeholders and\n * a list of buffers.\n *\n * @param {Object} packet\n * @return {Buffer} encoded\n * @api private\n */\n\nfunction encodeAsBinary(obj, callback) {\n\n  function writeEncoding(bloblessData) {\n    var deconstruction = binary.deconstructPacket(bloblessData);\n    var pack = encodeAsString(deconstruction.packet);\n    var buffers = deconstruction.buffers;\n\n    buffers.unshift(pack); // add packet info to beginning of data list\n    callback(buffers); // write all the buffers\n  }\n\n  binary.removeBlobs(obj, writeEncoding);\n}\n\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n * @api public\n */\n\nfunction Decoder() {\n  this.reconstructor = null;\n}\n\n/**\n * Mix in `Emitter` with Decoder.\n */\n\nEmitter(Decoder.prototype);\n\n/**\n * Decodes an ecoded packet string into packet JSON.\n *\n * @param {String} obj - encoded packet\n * @return {Object} packet\n * @api public\n */\n\nDecoder.prototype.add = function(obj) {\n  var packet;\n  if ('string' == typeof obj) {\n    packet = decodeString(obj);\n    if (exports.BINARY_EVENT == packet.type || exports.BINARY_ACK == packet.type) { // binary packet's json\n      this.reconstructor = new BinaryReconstructor(packet);\n\n      // no attachments, labeled binary but no binary data to follow\n      if (this.reconstructor.reconPack.attachments === 0) {\n        this.emit('decoded', packet);\n      }\n    } else { // non-binary full packet\n      this.emit('decoded', packet);\n    }\n  }\n  else if (isBuf(obj) || obj.base64) { // raw binary data\n    if (!this.reconstructor) {\n      throw new Error('got binary data when not reconstructing a packet');\n    } else {\n      packet = this.reconstructor.takeBinaryData(obj);\n      if (packet) { // received final buffer\n        this.reconstructor = null;\n        this.emit('decoded', packet);\n      }\n    }\n  }\n  else {\n    throw new Error('Unknown type: ' + obj);\n  }\n};\n\n/**\n * Decode a packet String (JSON data)\n *\n * @param {String} str\n * @return {Object} packet\n * @api private\n */\n\nfunction decodeString(str) {\n  var p = {};\n  var i = 0;\n\n  // look up type\n  p.type = Number(str.charAt(0));\n  if (null == exports.types[p.type]) return error();\n\n  // look up attachments if type binary\n  if (exports.BINARY_EVENT == p.type || exports.BINARY_ACK == p.type) {\n    var buf = '';\n    while (str.charAt(++i) != '-') {\n      buf += str.charAt(i);\n      if (i + 1 == str.length) break;\n    }\n    if (buf != Number(buf) || str.charAt(i) != '-') {\n      throw new Error('Illegal attachments');\n    }\n    p.attachments = Number(buf);\n  }\n\n  // look up namespace (if any)\n  if ('/' == str.charAt(i + 1)) {\n    p.nsp = '';\n    while (++i) {\n      var c = str.charAt(i);\n      if (',' == c) break;\n      p.nsp += c;\n      if (i + 1 == str.length) break;\n    }\n  } else {\n    p.nsp = '/';\n  }\n\n  // look up id\n  var next = str.charAt(i + 1);\n  if ('' !== next && Number(next) == next) {\n    p.id = '';\n    while (++i) {\n      var c = str.charAt(i);\n      if (null == c || Number(c) != c) {\n        --i;\n        break;\n      }\n      p.id += str.charAt(i);\n      if (i + 1 == str.length) break;\n    }\n    p.id = Number(p.id);\n  }\n\n  // look up json data\n  if (str.charAt(++i)) {\n    try {\n      p.data = json.parse(str.substr(i));\n    } catch(e){\n      return error();\n    }\n  }\n\n  debug('decoded %s as %j', str, p);\n  return p;\n}\n\n/**\n * Deallocates a parser's resources\n *\n * @api public\n */\n\nDecoder.prototype.destroy = function() {\n  if (this.reconstructor) {\n    this.reconstructor.finishedReconstruction();\n  }\n};\n\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n * @api private\n */\n\nfunction BinaryReconstructor(packet) {\n  this.reconPack = packet;\n  this.buffers = [];\n}\n\n/**\n * Method to be called when binary data received from connection\n * after a BINARY_EVENT packet.\n *\n * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n * @return {null | Object} returns null if more binary data is expected or\n *   a reconstructed packet object if all buffers have been received.\n * @api private\n */\n\nBinaryReconstructor.prototype.takeBinaryData = function(binData) {\n  this.buffers.push(binData);\n  if (this.buffers.length == this.reconPack.attachments) { // done with buffer list\n    var packet = binary.reconstructPacket(this.reconPack, this.buffers);\n    this.finishedReconstruction();\n    return packet;\n  }\n  return null;\n};\n\n/**\n * Cleans up binary packet reconstruction variables.\n *\n * @api private\n */\n\nBinaryReconstructor.prototype.finishedReconstruction = function() {\n  this.reconPack = null;\n  this.buffers = [];\n};\n\nfunction error(data){\n  return {\n    type: exports.ERROR,\n    data: 'parser error'\n  };\n}\n\n},{\"./binary\":47,\"./is-buffer\":49,\"component-emitter\":11,\"debug\":12,\"isarray\":50,\"json3\":51}],49:[function(_dereq_,module,exports){\n(function (global){\n\nmodule.exports = isBuf;\n\n/**\n * Returns true if obj is a buffer or an arraybuffer.\n *\n * @api private\n */\n\nfunction isBuf(obj) {\n  return (global.Buffer && global.Buffer.isBuffer(obj)) ||\n         (global.ArrayBuffer && obj instanceof ArrayBuffer);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],50:[function(_dereq_,module,exports){\narguments[4][34][0].apply(exports,arguments)\n},{\"dup\":34}],51:[function(_dereq_,module,exports){\n/*! JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org */\n;(function (window) {\n  // Convenience aliases.\n  var getClass = {}.toString, isProperty, forEach, undef;\n\n  // Detect the `define` function exposed by asynchronous module loaders. The\n  // strict `define` check is necessary for compatibility with `r.js`.\n  var isLoader = typeof define === \"function\" && define.amd;\n\n  // Detect native implementations.\n  var nativeJSON = typeof JSON == \"object\" && JSON;\n\n  // Set up the JSON 3 namespace, preferring the CommonJS `exports` object if\n  // available.\n  var JSON3 = typeof exports == \"object\" && exports && !exports.nodeType && exports;\n\n  if (JSON3 && nativeJSON) {\n    // Explicitly delegate to the native `stringify` and `parse`\n    // implementations in CommonJS environments.\n    JSON3.stringify = nativeJSON.stringify;\n    JSON3.parse = nativeJSON.parse;\n  } else {\n    // Export for web browsers, JavaScript engines, and asynchronous module\n    // loaders, using the global `JSON` object if available.\n    JSON3 = window.JSON = nativeJSON || {};\n  }\n\n  // Test the `Date#getUTC*` methods. Based on work by @Yaffle.\n  var isExtended = new Date(-3509827334573292);\n  try {\n    // The `getUTCFullYear`, `Month`, and `Date` methods return nonsensical\n    // results for certain dates in Opera >= 10.53.\n    isExtended = isExtended.getUTCFullYear() == -109252 && isExtended.getUTCMonth() === 0 && isExtended.getUTCDate() === 1 &&\n      // Safari < 2.0.2 stores the internal millisecond time value correctly,\n      // but clips the values returned by the date methods to the range of\n      // signed 32-bit integers ([-2 ** 31, 2 ** 31 - 1]).\n      isExtended.getUTCHours() == 10 && isExtended.getUTCMinutes() == 37 && isExtended.getUTCSeconds() == 6 && isExtended.getUTCMilliseconds() == 708;\n  } catch (exception) {}\n\n  // Internal: Determines whether the native `JSON.stringify` and `parse`\n  // implementations are spec-compliant. Based on work by Ken Snyder.\n  function has(name) {\n    if (has[name] !== undef) {\n      // Return cached feature test result.\n      return has[name];\n    }\n\n    var isSupported;\n    if (name == \"bug-string-char-index\") {\n      // IE <= 7 doesn't support accessing string characters using square\n      // bracket notation. IE 8 only supports this for primitives.\n      isSupported = \"a\"[0] != \"a\";\n    } else if (name == \"json\") {\n      // Indicates whether both `JSON.stringify` and `JSON.parse` are\n      // supported.\n      isSupported = has(\"json-stringify\") && has(\"json-parse\");\n    } else {\n      var value, serialized = '{\"a\":[1,true,false,null,\"\\\\u0000\\\\b\\\\n\\\\f\\\\r\\\\t\"]}';\n      // Test `JSON.stringify`.\n      if (name == \"json-stringify\") {\n        var stringify = JSON3.stringify, stringifySupported = typeof stringify == \"function\" && isExtended;\n        if (stringifySupported) {\n          // A test function object with a custom `toJSON` method.\n          (value = function () {\n            return 1;\n          }).toJSON = value;\n          try {\n            stringifySupported =\n              // Firefox 3.1b1 and b2 serialize string, number, and boolean\n              // primitives as object literals.\n              stringify(0) === \"0\" &&\n              // FF 3.1b1, b2, and JSON 2 serialize wrapped primitives as object\n              // literals.\n              stringify(new Number()) === \"0\" &&\n              stringify(new String()) == '\"\"' &&\n              // FF 3.1b1, 2 throw an error if the value is `null`, `undefined`, or\n              // does not define a canonical JSON representation (this applies to\n              // objects with `toJSON` properties as well, *unless* they are nested\n              // within an object or array).\n              stringify(getClass) === undef &&\n              // IE 8 serializes `undefined` as `\"undefined\"`. Safari <= 5.1.7 and\n              // FF 3.1b3 pass this test.\n              stringify(undef) === undef &&\n              // Safari <= 5.1.7 and FF 3.1b3 throw `Error`s and `TypeError`s,\n              // respectively, if the value is omitted entirely.\n              stringify() === undef &&\n              // FF 3.1b1, 2 throw an error if the given value is not a number,\n              // string, array, object, Boolean, or `null` literal. This applies to\n              // objects with custom `toJSON` methods as well, unless they are nested\n              // inside object or array literals. YUI 3.0.0b1 ignores custom `toJSON`\n              // methods entirely.\n              stringify(value) === \"1\" &&\n              stringify([value]) == \"[1]\" &&\n              // Prototype <= 1.6.1 serializes `[undefined]` as `\"[]\"` instead of\n              // `\"[null]\"`.\n              stringify([undef]) == \"[null]\" &&\n              // YUI 3.0.0b1 fails to serialize `null` literals.\n              stringify(null) == \"null\" &&\n              // FF 3.1b1, 2 halts serialization if an array contains a function:\n              // `[1, true, getClass, 1]` serializes as \"[1,true,],\". FF 3.1b3\n              // elides non-JSON values from objects and arrays, unless they\n              // define custom `toJSON` methods.\n              stringify([undef, getClass, null]) == \"[null,null,null]\" &&\n              // Simple serialization test. FF 3.1b1 uses Unicode escape sequences\n              // where character escape codes are expected (e.g., `\\b` => `\\u0008`).\n              stringify({ \"a\": [value, true, false, null, \"\\x00\\b\\n\\f\\r\\t\"] }) == serialized &&\n              // FF 3.1b1 and b2 ignore the `filter` and `width` arguments.\n              stringify(null, value) === \"1\" &&\n              stringify([1, 2], null, 1) == \"[\\n 1,\\n 2\\n]\" &&\n              // JSON 2, Prototype <= 1.7, and older WebKit builds incorrectly\n              // serialize extended years.\n              stringify(new Date(-8.64e15)) == '\"-271821-04-20T00:00:00.000Z\"' &&\n              // The milliseconds are optional in ES 5, but required in 5.1.\n              stringify(new Date(8.64e15)) == '\"+275760-09-13T00:00:00.000Z\"' &&\n              // Firefox <= 11.0 incorrectly serializes years prior to 0 as negative\n              // four-digit years instead of six-digit years. Credits: @Yaffle.\n              stringify(new Date(-621987552e5)) == '\"-000001-01-01T00:00:00.000Z\"' &&\n              // Safari <= 5.1.5 and Opera >= 10.53 incorrectly serialize millisecond\n              // values less than 1000. Credits: @Yaffle.\n              stringify(new Date(-1)) == '\"1969-12-31T23:59:59.999Z\"';\n          } catch (exception) {\n            stringifySupported = false;\n          }\n        }\n        isSupported = stringifySupported;\n      }\n      // Test `JSON.parse`.\n      if (name == \"json-parse\") {\n        var parse = JSON3.parse;\n        if (typeof parse == \"function\") {\n          try {\n            // FF 3.1b1, b2 will throw an exception if a bare literal is provided.\n            // Conforming implementations should also coerce the initial argument to\n            // a string prior to parsing.\n            if (parse(\"0\") === 0 && !parse(false)) {\n              // Simple parsing test.\n              value = parse(serialized);\n              var parseSupported = value[\"a\"].length == 5 && value[\"a\"][0] === 1;\n              if (parseSupported) {\n                try {\n                  // Safari <= 5.1.2 and FF 3.1b1 allow unescaped tabs in strings.\n                  parseSupported = !parse('\"\\t\"');\n                } catch (exception) {}\n                if (parseSupported) {\n                  try {\n                    // FF 4.0 and 4.0.1 allow leading `+` signs and leading\n                    // decimal points. FF 4.0, 4.0.1, and IE 9-10 also allow\n                    // certain octal literals.\n                    parseSupported = parse(\"01\") !== 1;\n                  } catch (exception) {}\n                }\n                if (parseSupported) {\n                  try {\n                    // FF 4.0, 4.0.1, and Rhino 1.7R3-R4 allow trailing decimal\n                    // points. These environments, along with FF 3.1b1 and 2,\n                    // also allow trailing commas in JSON objects and arrays.\n                    parseSupported = parse(\"1.\") !== 1;\n                  } catch (exception) {}\n                }\n              }\n            }\n          } catch (exception) {\n            parseSupported = false;\n          }\n        }\n        isSupported = parseSupported;\n      }\n    }\n    return has[name] = !!isSupported;\n  }\n\n  if (!has(\"json\")) {\n    // Common `[[Class]]` name aliases.\n    var functionClass = \"[object Function]\";\n    var dateClass = \"[object Date]\";\n    var numberClass = \"[object Number]\";\n    var stringClass = \"[object String]\";\n    var arrayClass = \"[object Array]\";\n    var booleanClass = \"[object Boolean]\";\n\n    // Detect incomplete support for accessing string characters by index.\n    var charIndexBuggy = has(\"bug-string-char-index\");\n\n    // Define additional utility methods if the `Date` methods are buggy.\n    if (!isExtended) {\n      var floor = Math.floor;\n      // A mapping between the months of the year and the number of days between\n      // January 1st and the first of the respective month.\n      var Months = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];\n      // Internal: Calculates the number of days between the Unix epoch and the\n      // first day of the given month.\n      var getDay = function (year, month) {\n        return Months[month] + 365 * (year - 1970) + floor((year - 1969 + (month = +(month > 1))) / 4) - floor((year - 1901 + month) / 100) + floor((year - 1601 + month) / 400);\n      };\n    }\n\n    // Internal: Determines if a property is a direct property of the given\n    // object. Delegates to the native `Object#hasOwnProperty` method.\n    if (!(isProperty = {}.hasOwnProperty)) {\n      isProperty = function (property) {\n        var members = {}, constructor;\n        if ((members.__proto__ = null, members.__proto__ = {\n          // The *proto* property cannot be set multiple times in recent\n          // versions of Firefox and SeaMonkey.\n          \"toString\": 1\n        }, members).toString != getClass) {\n          // Safari <= 2.0.3 doesn't implement `Object#hasOwnProperty`, but\n          // supports the mutable *proto* property.\n          isProperty = function (property) {\n            // Capture and break the object's prototype chain (see section 8.6.2\n            // of the ES 5.1 spec). The parenthesized expression prevents an\n            // unsafe transformation by the Closure Compiler.\n            var original = this.__proto__, result = property in (this.__proto__ = null, this);\n            // Restore the original prototype chain.\n            this.__proto__ = original;\n            return result;\n          };\n        } else {\n          // Capture a reference to the top-level `Object` constructor.\n          constructor = members.constructor;\n          // Use the `constructor` property to simulate `Object#hasOwnProperty` in\n          // other environments.\n          isProperty = function (property) {\n            var parent = (this.constructor || constructor).prototype;\n            return property in this && !(property in parent && this[property] === parent[property]);\n          };\n        }\n        members = null;\n        return isProperty.call(this, property);\n      };\n    }\n\n    // Internal: A set of primitive types used by `isHostType`.\n    var PrimitiveTypes = {\n      'boolean': 1,\n      'number': 1,\n      'string': 1,\n      'undefined': 1\n    };\n\n    // Internal: Determines if the given object `property` value is a\n    // non-primitive.\n    var isHostType = function (object, property) {\n      var type = typeof object[property];\n      return type == 'object' ? !!object[property] : !PrimitiveTypes[type];\n    };\n\n    // Internal: Normalizes the `for...in` iteration algorithm across\n    // environments. Each enumerated key is yielded to a `callback` function.\n    forEach = function (object, callback) {\n      var size = 0, Properties, members, property;\n\n      // Tests for bugs in the current environment's `for...in` algorithm. The\n      // `valueOf` property inherits the non-enumerable flag from\n      // `Object.prototype` in older versions of IE, Netscape, and Mozilla.\n      (Properties = function () {\n        this.valueOf = 0;\n      }).prototype.valueOf = 0;\n\n      // Iterate over a new instance of the `Properties` class.\n      members = new Properties();\n      for (property in members) {\n        // Ignore all properties inherited from `Object.prototype`.\n        if (isProperty.call(members, property)) {\n          size++;\n        }\n      }\n      Properties = members = null;\n\n      // Normalize the iteration algorithm.\n      if (!size) {\n        // A list of non-enumerable properties inherited from `Object.prototype`.\n        members = [\"valueOf\", \"toString\", \"toLocaleString\", \"propertyIsEnumerable\", \"isPrototypeOf\", \"hasOwnProperty\", \"constructor\"];\n        // IE <= 8, Mozilla 1.0, and Netscape 6.2 ignore shadowed non-enumerable\n        // properties.\n        forEach = function (object, callback) {\n          var isFunction = getClass.call(object) == functionClass, property, length;\n          var hasProperty = !isFunction && typeof object.constructor != 'function' && isHostType(object, 'hasOwnProperty') ? object.hasOwnProperty : isProperty;\n          for (property in object) {\n            // Gecko <= 1.0 enumerates the `prototype` property of functions under\n            // certain conditions; IE does not.\n            if (!(isFunction && property == \"prototype\") && hasProperty.call(object, property)) {\n              callback(property);\n            }\n          }\n          // Manually invoke the callback for each non-enumerable property.\n          for (length = members.length; property = members[--length]; hasProperty.call(object, property) && callback(property));\n        };\n      } else if (size == 2) {\n        // Safari <= 2.0.4 enumerates shadowed properties twice.\n        forEach = function (object, callback) {\n          // Create a set of iterated properties.\n          var members = {}, isFunction = getClass.call(object) == functionClass, property;\n          for (property in object) {\n            // Store each property name to prevent double enumeration. The\n            // `prototype` property of functions is not enumerated due to cross-\n            // environment inconsistencies.\n            if (!(isFunction && property == \"prototype\") && !isProperty.call(members, property) && (members[property] = 1) && isProperty.call(object, property)) {\n              callback(property);\n            }\n          }\n        };\n      } else {\n        // No bugs detected; use the standard `for...in` algorithm.\n        forEach = function (object, callback) {\n          var isFunction = getClass.call(object) == functionClass, property, isConstructor;\n          for (property in object) {\n            if (!(isFunction && property == \"prototype\") && isProperty.call(object, property) && !(isConstructor = property === \"constructor\")) {\n              callback(property);\n            }\n          }\n          // Manually invoke the callback for the `constructor` property due to\n          // cross-environment inconsistencies.\n          if (isConstructor || isProperty.call(object, (property = \"constructor\"))) {\n            callback(property);\n          }\n        };\n      }\n      return forEach(object, callback);\n    };\n\n    // Public: Serializes a JavaScript `value` as a JSON string. The optional\n    // `filter` argument may specify either a function that alters how object and\n    // array members are serialized, or an array of strings and numbers that\n    // indicates which properties should be serialized. The optional `width`\n    // argument may be either a string or number that specifies the indentation\n    // level of the output.\n    if (!has(\"json-stringify\")) {\n      // Internal: A map of control characters and their escaped equivalents.\n      var Escapes = {\n        92: \"\\\\\\\\\",\n        34: '\\\\\"',\n        8: \"\\\\b\",\n        12: \"\\\\f\",\n        10: \"\\\\n\",\n        13: \"\\\\r\",\n        9: \"\\\\t\"\n      };\n\n      // Internal: Converts `value` into a zero-padded string such that its\n      // length is at least equal to `width`. The `width` must be <= 6.\n      var leadingZeroes = \"000000\";\n      var toPaddedString = function (width, value) {\n        // The `|| 0` expression is necessary to work around a bug in\n        // Opera <= 7.54u2 where `0 == -0`, but `String(-0) !== \"0\"`.\n        return (leadingZeroes + (value || 0)).slice(-width);\n      };\n\n      // Internal: Double-quotes a string `value`, replacing all ASCII control\n      // characters (characters with code unit values between 0 and 31) with\n      // their escaped equivalents. This is an implementation of the\n      // `Quote(value)` operation defined in ES 5.1 section 15.12.3.\n      var unicodePrefix = \"\\\\u00\";\n      var quote = function (value) {\n        var result = '\"', index = 0, length = value.length, isLarge = length > 10 && charIndexBuggy, symbols;\n        if (isLarge) {\n          symbols = value.split(\"\");\n        }\n        for (; index < length; index++) {\n          var charCode = value.charCodeAt(index);\n          // If the character is a control character, append its Unicode or\n          // shorthand escape sequence; otherwise, append the character as-is.\n          switch (charCode) {\n            case 8: case 9: case 10: case 12: case 13: case 34: case 92:\n              result += Escapes[charCode];\n              break;\n            default:\n              if (charCode < 32) {\n                result += unicodePrefix + toPaddedString(2, charCode.toString(16));\n                break;\n              }\n              result += isLarge ? symbols[index] : charIndexBuggy ? value.charAt(index) : value[index];\n          }\n        }\n        return result + '\"';\n      };\n\n      // Internal: Recursively serializes an object. Implements the\n      // `Str(key, holder)`, `JO(value)`, and `JA(value)` operations.\n      var serialize = function (property, object, callback, properties, whitespace, indentation, stack) {\n        var value, className, year, month, date, time, hours, minutes, seconds, milliseconds, results, element, index, length, prefix, result;\n        try {\n          // Necessary for host object support.\n          value = object[property];\n        } catch (exception) {}\n        if (typeof value == \"object\" && value) {\n          className = getClass.call(value);\n          if (className == dateClass && !isProperty.call(value, \"toJSON\")) {\n            if (value > -1 / 0 && value < 1 / 0) {\n              // Dates are serialized according to the `Date#toJSON` method\n              // specified in ES 5.1 section 15.9.5.44. See section 15.9.1.15\n              // for the ISO 8601 date time string format.\n              if (getDay) {\n                // Manually compute the year, month, date, hours, minutes,\n                // seconds, and milliseconds if the `getUTC*` methods are\n                // buggy. Adapted from @Yaffle's `date-shim` project.\n                date = floor(value / 864e5);\n                for (year = floor(date / 365.2425) + 1970 - 1; getDay(year + 1, 0) <= date; year++);\n                for (month = floor((date - getDay(year, 0)) / 30.42); getDay(year, month + 1) <= date; month++);\n                date = 1 + date - getDay(year, month);\n                // The `time` value specifies the time within the day (see ES\n                // 5.1 section 15.9.1.2). The formula `(A % B + B) % B` is used\n                // to compute `A modulo B`, as the `%` operator does not\n                // correspond to the `modulo` operation for negative numbers.\n                time = (value % 864e5 + 864e5) % 864e5;\n                // The hours, minutes, seconds, and milliseconds are obtained by\n                // decomposing the time within the day. See section 15.9.1.10.\n                hours = floor(time / 36e5) % 24;\n                minutes = floor(time / 6e4) % 60;\n                seconds = floor(time / 1e3) % 60;\n                milliseconds = time % 1e3;\n              } else {\n                year = value.getUTCFullYear();\n                month = value.getUTCMonth();\n                date = value.getUTCDate();\n                hours = value.getUTCHours();\n                minutes = value.getUTCMinutes();\n                seconds = value.getUTCSeconds();\n                milliseconds = value.getUTCMilliseconds();\n              }\n              // Serialize extended years correctly.\n              value = (year <= 0 || year >= 1e4 ? (year < 0 ? \"-\" : \"+\") + toPaddedString(6, year < 0 ? -year : year) : toPaddedString(4, year)) +\n                \"-\" + toPaddedString(2, month + 1) + \"-\" + toPaddedString(2, date) +\n                // Months, dates, hours, minutes, and seconds should have two\n                // digits; milliseconds should have three.\n                \"T\" + toPaddedString(2, hours) + \":\" + toPaddedString(2, minutes) + \":\" + toPaddedString(2, seconds) +\n                // Milliseconds are optional in ES 5.0, but required in 5.1.\n                \".\" + toPaddedString(3, milliseconds) + \"Z\";\n            } else {\n              value = null;\n            }\n          } else if (typeof value.toJSON == \"function\" && ((className != numberClass && className != stringClass && className != arrayClass) || isProperty.call(value, \"toJSON\"))) {\n            // Prototype <= 1.6.1 adds non-standard `toJSON` methods to the\n            // `Number`, `String`, `Date`, and `Array` prototypes. JSON 3\n            // ignores all `toJSON` methods on these objects unless they are\n            // defined directly on an instance.\n            value = value.toJSON(property);\n          }\n        }\n        if (callback) {\n          // If a replacement function was provided, call it to obtain the value\n          // for serialization.\n          value = callback.call(object, property, value);\n        }\n        if (value === null) {\n          return \"null\";\n        }\n        className = getClass.call(value);\n        if (className == booleanClass) {\n          // Booleans are represented literally.\n          return \"\" + value;\n        } else if (className == numberClass) {\n          // JSON numbers must be finite. `Infinity` and `NaN` are serialized as\n          // `\"null\"`.\n          return value > -1 / 0 && value < 1 / 0 ? \"\" + value : \"null\";\n        } else if (className == stringClass) {\n          // Strings are double-quoted and escaped.\n          return quote(\"\" + value);\n        }\n        // Recursively serialize objects and arrays.\n        if (typeof value == \"object\") {\n          // Check for cyclic structures. This is a linear search; performance\n          // is inversely proportional to the number of unique nested objects.\n          for (length = stack.length; length--;) {\n            if (stack[length] === value) {\n              // Cyclic structures cannot be serialized by `JSON.stringify`.\n              throw TypeError();\n            }\n          }\n          // Add the object to the stack of traversed objects.\n          stack.push(value);\n          results = [];\n          // Save the current indentation level and indent one additional level.\n          prefix = indentation;\n          indentation += whitespace;\n          if (className == arrayClass) {\n            // Recursively serialize array elements.\n            for (index = 0, length = value.length; index < length; index++) {\n              element = serialize(index, value, callback, properties, whitespace, indentation, stack);\n              results.push(element === undef ? \"null\" : element);\n            }\n            result = results.length ? (whitespace ? \"[\\n\" + indentation + results.join(\",\\n\" + indentation) + \"\\n\" + prefix + \"]\" : (\"[\" + results.join(\",\") + \"]\")) : \"[]\";\n          } else {\n            // Recursively serialize object members. Members are selected from\n            // either a user-specified list of property names, or the object\n            // itself.\n            forEach(properties || value, function (property) {\n              var element = serialize(property, value, callback, properties, whitespace, indentation, stack);\n              if (element !== undef) {\n                // According to ES 5.1 section 15.12.3: \"If `gap` {whitespace}\n                // is not the empty string, let `member` {quote(property) + \":\"}\n                // be the concatenation of `member` and the `space` character.\"\n                // The \"`space` character\" refers to the literal space\n                // character, not the `space` {width} argument provided to\n                // `JSON.stringify`.\n                results.push(quote(property) + \":\" + (whitespace ? \" \" : \"\") + element);\n              }\n            });\n            result = results.length ? (whitespace ? \"{\\n\" + indentation + results.join(\",\\n\" + indentation) + \"\\n\" + prefix + \"}\" : (\"{\" + results.join(\",\") + \"}\")) : \"{}\";\n          }\n          // Remove the object from the traversed object stack.\n          stack.pop();\n          return result;\n        }\n      };\n\n      // Public: `JSON.stringify`. See ES 5.1 section 15.12.3.\n      JSON3.stringify = function (source, filter, width) {\n        var whitespace, callback, properties, className;\n        if (typeof filter == \"function\" || typeof filter == \"object\" && filter) {\n          if ((className = getClass.call(filter)) == functionClass) {\n            callback = filter;\n          } else if (className == arrayClass) {\n            // Convert the property names array into a makeshift set.\n            properties = {};\n            for (var index = 0, length = filter.length, value; index < length; value = filter[index++], ((className = getClass.call(value)), className == stringClass || className == numberClass) && (properties[value] = 1));\n          }\n        }\n        if (width) {\n          if ((className = getClass.call(width)) == numberClass) {\n            // Convert the `width` to an integer and create a string containing\n            // `width` number of space characters.\n            if ((width -= width % 1) > 0) {\n              for (whitespace = \"\", width > 10 && (width = 10); whitespace.length < width; whitespace += \" \");\n            }\n          } else if (className == stringClass) {\n            whitespace = width.length <= 10 ? width : width.slice(0, 10);\n          }\n        }\n        // Opera <= 7.54u2 discards the values associated with empty string keys\n        // (`\"\"`) only if they are used directly within an object member list\n        // (e.g., `!(\"\" in { \"\": 1})`).\n        return serialize(\"\", (value = {}, value[\"\"] = source, value), callback, properties, whitespace, \"\", []);\n      };\n    }\n\n    // Public: Parses a JSON source string.\n    if (!has(\"json-parse\")) {\n      var fromCharCode = String.fromCharCode;\n\n      // Internal: A map of escaped control characters and their unescaped\n      // equivalents.\n      var Unescapes = {\n        92: \"\\\\\",\n        34: '\"',\n        47: \"/\",\n        98: \"\\b\",\n        116: \"\\t\",\n        110: \"\\n\",\n        102: \"\\f\",\n        114: \"\\r\"\n      };\n\n      // Internal: Stores the parser state.\n      var Index, Source;\n\n      // Internal: Resets the parser state and throws a `SyntaxError`.\n      var abort = function() {\n        Index = Source = null;\n        throw SyntaxError();\n      };\n\n      // Internal: Returns the next token, or `\"$\"` if the parser has reached\n      // the end of the source string. A token may be a string, number, `null`\n      // literal, or Boolean literal.\n      var lex = function () {\n        var source = Source, length = source.length, value, begin, position, isSigned, charCode;\n        while (Index < length) {\n          charCode = source.charCodeAt(Index);\n          switch (charCode) {\n            case 9: case 10: case 13: case 32:\n              // Skip whitespace tokens, including tabs, carriage returns, line\n              // feeds, and space characters.\n              Index++;\n              break;\n            case 123: case 125: case 91: case 93: case 58: case 44:\n              // Parse a punctuator token (`{`, `}`, `[`, `]`, `:`, or `,`) at\n              // the current position.\n              value = charIndexBuggy ? source.charAt(Index) : source[Index];\n              Index++;\n              return value;\n            case 34:\n              // `\"` delimits a JSON string; advance to the next character and\n              // begin parsing the string. String tokens are prefixed with the\n              // sentinel `@` character to distinguish them from punctuators and\n              // end-of-string tokens.\n              for (value = \"@\", Index++; Index < length;) {\n                charCode = source.charCodeAt(Index);\n                if (charCode < 32) {\n                  // Unescaped ASCII control characters (those with a code unit\n                  // less than the space character) are not permitted.\n                  abort();\n                } else if (charCode == 92) {\n                  // A reverse solidus (`\\`) marks the beginning of an escaped\n                  // control character (including `\"`, `\\`, and `/`) or Unicode\n                  // escape sequence.\n                  charCode = source.charCodeAt(++Index);\n                  switch (charCode) {\n                    case 92: case 34: case 47: case 98: case 116: case 110: case 102: case 114:\n                      // Revive escaped control characters.\n                      value += Unescapes[charCode];\n                      Index++;\n                      break;\n                    case 117:\n                      // `\\u` marks the beginning of a Unicode escape sequence.\n                      // Advance to the first character and validate the\n                      // four-digit code point.\n                      begin = ++Index;\n                      for (position = Index + 4; Index < position; Index++) {\n                        charCode = source.charCodeAt(Index);\n                        // A valid sequence comprises four hexdigits (case-\n                        // insensitive) that form a single hexadecimal value.\n                        if (!(charCode >= 48 && charCode <= 57 || charCode >= 97 && charCode <= 102 || charCode >= 65 && charCode <= 70)) {\n                          // Invalid Unicode escape sequence.\n                          abort();\n                        }\n                      }\n                      // Revive the escaped character.\n                      value += fromCharCode(\"0x\" + source.slice(begin, Index));\n                      break;\n                    default:\n                      // Invalid escape sequence.\n                      abort();\n                  }\n                } else {\n                  if (charCode == 34) {\n                    // An unescaped double-quote character marks the end of the\n                    // string.\n                    break;\n                  }\n                  charCode = source.charCodeAt(Index);\n                  begin = Index;\n                  // Optimize for the common case where a string is valid.\n                  while (charCode >= 32 && charCode != 92 && charCode != 34) {\n                    charCode = source.charCodeAt(++Index);\n                  }\n                  // Append the string as-is.\n                  value += source.slice(begin, Index);\n                }\n              }\n              if (source.charCodeAt(Index) == 34) {\n                // Advance to the next character and return the revived string.\n                Index++;\n                return value;\n              }\n              // Unterminated string.\n              abort();\n            default:\n              // Parse numbers and literals.\n              begin = Index;\n              // Advance past the negative sign, if one is specified.\n              if (charCode == 45) {\n                isSigned = true;\n                charCode = source.charCodeAt(++Index);\n              }\n              // Parse an integer or floating-point value.\n              if (charCode >= 48 && charCode <= 57) {\n                // Leading zeroes are interpreted as octal literals.\n                if (charCode == 48 && ((charCode = source.charCodeAt(Index + 1)), charCode >= 48 && charCode <= 57)) {\n                  // Illegal octal literal.\n                  abort();\n                }\n                isSigned = false;\n                // Parse the integer component.\n                for (; Index < length && ((charCode = source.charCodeAt(Index)), charCode >= 48 && charCode <= 57); Index++);\n                // Floats cannot contain a leading decimal point; however, this\n                // case is already accounted for by the parser.\n                if (source.charCodeAt(Index) == 46) {\n                  position = ++Index;\n                  // Parse the decimal component.\n                  for (; position < length && ((charCode = source.charCodeAt(position)), charCode >= 48 && charCode <= 57); position++);\n                  if (position == Index) {\n                    // Illegal trailing decimal.\n                    abort();\n                  }\n                  Index = position;\n                }\n                // Parse exponents. The `e` denoting the exponent is\n                // case-insensitive.\n                charCode = source.charCodeAt(Index);\n                if (charCode == 101 || charCode == 69) {\n                  charCode = source.charCodeAt(++Index);\n                  // Skip past the sign following the exponent, if one is\n                  // specified.\n                  if (charCode == 43 || charCode == 45) {\n                    Index++;\n                  }\n                  // Parse the exponential component.\n                  for (position = Index; position < length && ((charCode = source.charCodeAt(position)), charCode >= 48 && charCode <= 57); position++);\n                  if (position == Index) {\n                    // Illegal empty exponent.\n                    abort();\n                  }\n                  Index = position;\n                }\n                // Coerce the parsed value to a JavaScript number.\n                return +source.slice(begin, Index);\n              }\n              // A negative sign may only precede numbers.\n              if (isSigned) {\n                abort();\n              }\n              // `true`, `false`, and `null` literals.\n              if (source.slice(Index, Index + 4) == \"true\") {\n                Index += 4;\n                return true;\n              } else if (source.slice(Index, Index + 5) == \"false\") {\n                Index += 5;\n                return false;\n              } else if (source.slice(Index, Index + 4) == \"null\") {\n                Index += 4;\n                return null;\n              }\n              // Unrecognized token.\n              abort();\n          }\n        }\n        // Return the sentinel `$` character if the parser has reached the end\n        // of the source string.\n        return \"$\";\n      };\n\n      // Internal: Parses a JSON `value` token.\n      var get = function (value) {\n        var results, hasMembers;\n        if (value == \"$\") {\n          // Unexpected end of input.\n          abort();\n        }\n        if (typeof value == \"string\") {\n          if ((charIndexBuggy ? value.charAt(0) : value[0]) == \"@\") {\n            // Remove the sentinel `@` character.\n            return value.slice(1);\n          }\n          // Parse object and array literals.\n          if (value == \"[\") {\n            // Parses a JSON array, returning a new JavaScript array.\n            results = [];\n            for (;; hasMembers || (hasMembers = true)) {\n              value = lex();\n              // A closing square bracket marks the end of the array literal.\n              if (value == \"]\") {\n                break;\n              }\n              // If the array literal contains elements, the current token\n              // should be a comma separating the previous element from the\n              // next.\n              if (hasMembers) {\n                if (value == \",\") {\n                  value = lex();\n                  if (value == \"]\") {\n                    // Unexpected trailing `,` in array literal.\n                    abort();\n                  }\n                } else {\n                  // A `,` must separate each array element.\n                  abort();\n                }\n              }\n              // Elisions and leading commas are not permitted.\n              if (value == \",\") {\n                abort();\n              }\n              results.push(get(value));\n            }\n            return results;\n          } else if (value == \"{\") {\n            // Parses a JSON object, returning a new JavaScript object.\n            results = {};\n            for (;; hasMembers || (hasMembers = true)) {\n              value = lex();\n              // A closing curly brace marks the end of the object literal.\n              if (value == \"}\") {\n                break;\n              }\n              // If the object literal contains members, the current token\n              // should be a comma separator.\n              if (hasMembers) {\n                if (value == \",\") {\n                  value = lex();\n                  if (value == \"}\") {\n                    // Unexpected trailing `,` in object literal.\n                    abort();\n                  }\n                } else {\n                  // A `,` must separate each object member.\n                  abort();\n                }\n              }\n              // Leading commas are not permitted, object property names must be\n              // double-quoted strings, and a `:` must separate each property\n              // name and value.\n              if (value == \",\" || typeof value != \"string\" || (charIndexBuggy ? value.charAt(0) : value[0]) != \"@\" || lex() != \":\") {\n                abort();\n              }\n              results[value.slice(1)] = get(lex());\n            }\n            return results;\n          }\n          // Unexpected token encountered.\n          abort();\n        }\n        return value;\n      };\n\n      // Internal: Updates a traversed object member.\n      var update = function(source, property, callback) {\n        var element = walk(source, property, callback);\n        if (element === undef) {\n          delete source[property];\n        } else {\n          source[property] = element;\n        }\n      };\n\n      // Internal: Recursively traverses a parsed JSON object, invoking the\n      // `callback` function for each value. This is an implementation of the\n      // `Walk(holder, name)` operation defined in ES 5.1 section 15.12.2.\n      var walk = function (source, property, callback) {\n        var value = source[property], length;\n        if (typeof value == \"object\" && value) {\n          // `forEach` can't be used to traverse an array in Opera <= 8.54\n          // because its `Object#hasOwnProperty` implementation returns `false`\n          // for array indices (e.g., `![1, 2, 3].hasOwnProperty(\"0\")`).\n          if (getClass.call(value) == arrayClass) {\n            for (length = value.length; length--;) {\n              update(value, length, callback);\n            }\n          } else {\n            forEach(value, function (property) {\n              update(value, property, callback);\n            });\n          }\n        }\n        return callback.call(source, property, value);\n      };\n\n      // Public: `JSON.parse`. See ES 5.1 section 15.12.2.\n      JSON3.parse = function (source, callback) {\n        var result, value;\n        Index = 0;\n        Source = \"\" + source;\n        result = get(lex());\n        // If a JSON string contains multiple tokens, it is invalid.\n        if (lex() != \"$\") {\n          abort();\n        }\n        // Reset the parser state.\n        Index = Source = null;\n        return callback && getClass.call(callback) == functionClass ? walk((value = {}, value[\"\"] = result, value), \"\", callback) : result;\n      };\n    }\n  }\n\n  // Export for asynchronous module loaders.\n  if (isLoader) {\n    define(function () {\n      return JSON3;\n    });\n  }\n}(this));\n\n},{}],52:[function(_dereq_,module,exports){\nmodule.exports = toArray\n\nfunction toArray(list, index) {\n    var array = []\n\n    index = index || 0\n\n    for (var i = index || 0; i < list.length; i++) {\n        array[i - index] = list[i]\n    }\n\n    return array\n}\n\n},{}]},{},[1])(1)\n});"],"sourceRoot":"/source/"}